(function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/aggr/",n(n.s="6a5d")})({"07f4":function(t,e,n){"use strict";var r=n("be7f"),i=4,o=0,a=1,s=2;function u(t){var e=t.length;while(--e>=0)t[e]=0}var c=0,l=1,f=2,h=3,p=258,d=29,y=256,b=y+1+d,v=30,m=19,g=2*b+1,_=15,w=16,k=7,O=256,S=16,x=17,P=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],E=512,z=new Array(2*(b+2));u(z);var C=new Array(2*v);u(C);var I=new Array(E);u(I);var B=new Array(p-h+1);u(B);var N=new Array(d);u(N);var D,U,M,L=new Array(v);function q(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function J(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function Z(t){return t<256?I[t]:I[256+(t>>>7)]}function F(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function K(t,e,n){t.bi_valid>w-n?(t.bi_buf|=e<<t.bi_valid&65535,F(t,t.bi_buf),t.bi_buf=e>>w-t.bi_valid,t.bi_valid+=n-w):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function H(t,e,n){K(t,n[2*e],n[2*e+1])}function G(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function $(t){16===t.bi_valid?(F(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function W(t,e){var n,r,i,o,a,s,u=e.dyn_tree,c=e.max_code,l=e.stat_desc.static_tree,f=e.stat_desc.has_stree,h=e.stat_desc.extra_bits,p=e.stat_desc.extra_base,d=e.stat_desc.max_length,y=0;for(o=0;o<=_;o++)t.bl_count[o]=0;for(u[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<g;n++)r=t.heap[n],o=u[2*u[2*r+1]+1]+1,o>d&&(o=d,y++),u[2*r+1]=o,r>c||(t.bl_count[o]++,a=0,r>=p&&(a=h[r-p]),s=u[2*r],t.opt_len+=s*(o+a),f&&(t.static_len+=s*(l[2*r+1]+a)));if(0!==y){do{o=d-1;while(0===t.bl_count[o])o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[d]--,y-=2}while(y>0);for(o=d;0!==o;o--){r=t.bl_count[o];while(0!==r)i=t.heap[--n],i>c||(u[2*i+1]!==o&&(t.opt_len+=(o-u[2*i+1])*u[2*i],u[2*i+1]=o),r--)}}}function Q(t,e,n){var r,i,o=new Array(_+1),a=0;for(r=1;r<=_;r++)o[r]=a=a+n[r-1]<<1;for(i=0;i<=e;i++){var s=t[2*i+1];0!==s&&(t[2*i]=G(o[s]++,s))}}function X(){var t,e,n,r,i,o=new Array(_+1);for(n=0,r=0;r<d-1;r++)for(N[r]=n,t=0;t<1<<j[r];t++)B[n++]=r;for(B[n-1]=r,i=0,r=0;r<16;r++)for(L[r]=i,t=0;t<1<<R[r];t++)I[i++]=r;for(i>>=7;r<v;r++)for(L[r]=i<<7,t=0;t<1<<R[r]-7;t++)I[256+i++]=r;for(e=0;e<=_;e++)o[e]=0;t=0;while(t<=143)z[2*t+1]=8,t++,o[8]++;while(t<=255)z[2*t+1]=9,t++,o[9]++;while(t<=279)z[2*t+1]=7,t++,o[7]++;while(t<=287)z[2*t+1]=8,t++,o[8]++;for(Q(z,b+1,o),t=0;t<v;t++)C[2*t+1]=5,C[2*t]=G(t,5);D=new q(z,j,y+1,b,_),U=new q(C,R,0,v,_),M=new q(new Array(0),A,0,m,k)}function Y(t){var e;for(e=0;e<b;e++)t.dyn_ltree[2*e]=0;for(e=0;e<v;e++)t.dyn_dtree[2*e]=0;for(e=0;e<m;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*O]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function V(t){t.bi_valid>8?F(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function tt(t,e,n,i){V(t),i&&(F(t,n),F(t,~n)),r.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}function et(t,e,n,r){var i=2*e,o=2*n;return t[i]<t[o]||t[i]===t[o]&&r[e]<=r[n]}function nt(t,e,n){var r=t.heap[n],i=n<<1;while(i<=t.heap_len){if(i<t.heap_len&&et(e,t.heap[i+1],t.heap[i],t.depth)&&i++,et(e,r,t.heap[i],t.depth))break;t.heap[n]=t.heap[i],n=i,i<<=1}t.heap[n]=r}function rt(t,e,n){var r,i,o,a,s=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],i=t.pending_buf[t.l_buf+s],s++,0===r?H(t,i,e):(o=B[i],H(t,o+y+1,e),a=j[o],0!==a&&(i-=N[o],K(t,i,a)),r--,o=Z(r),H(t,o,n),a=R[o],0!==a&&(r-=L[o],K(t,r,a)))}while(s<t.last_lit);H(t,O,e)}function it(t,e){var n,r,i,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,u=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=g,n=0;n<u;n++)0!==o[2*n]?(t.heap[++t.heap_len]=c=n,t.depth[n]=0):o[2*n+1]=0;while(t.heap_len<2)i=t.heap[++t.heap_len]=c<2?++c:0,o[2*i]=1,t.depth[i]=0,t.opt_len--,s&&(t.static_len-=a[2*i+1]);for(e.max_code=c,n=t.heap_len>>1;n>=1;n--)nt(t,o,n);i=u;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],nt(t,o,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,o[2*i]=o[2*n]+o[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,o[2*n+1]=o[2*r+1]=i,t.heap[1]=i++,nt(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],W(t,e),Q(o,c,t.bl_count)}function ot(t,e,n){var r,i,o=-1,a=e[1],s=0,u=7,c=4;for(0===a&&(u=138,c=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=e[2*(r+1)+1],++s<u&&i===a||(s<c?t.bl_tree[2*i]+=s:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[2*S]++):s<=10?t.bl_tree[2*x]++:t.bl_tree[2*P]++,s=0,o=i,0===a?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4))}function at(t,e,n){var r,i,o=-1,a=e[1],s=0,u=7,c=4;for(0===a&&(u=138,c=3),r=0;r<=n;r++)if(i=a,a=e[2*(r+1)+1],!(++s<u&&i===a)){if(s<c)do{H(t,i,t.bl_tree)}while(0!==--s);else 0!==i?(i!==o&&(H(t,i,t.bl_tree),s--),H(t,S,t.bl_tree),K(t,s-3,2)):s<=10?(H(t,x,t.bl_tree),K(t,s-3,3)):(H(t,P,t.bl_tree),K(t,s-11,7));s=0,o=i,0===a?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4)}}function st(t){var e;for(ot(t,t.dyn_ltree,t.l_desc.max_code),ot(t,t.dyn_dtree,t.d_desc.max_code),it(t,t.bl_desc),e=m-1;e>=3;e--)if(0!==t.bl_tree[2*T[e]+1])break;return t.opt_len+=3*(e+1)+5+5+4,e}function ut(t,e,n,r){var i;for(K(t,e-257,5),K(t,n-1,5),K(t,r-4,4),i=0;i<r;i++)K(t,t.bl_tree[2*T[i]+1],3);at(t,t.dyn_ltree,e-1),at(t,t.dyn_dtree,n-1)}function ct(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(e=32;e<y;e++)if(0!==t.dyn_ltree[2*e])return a;return o}u(L);var lt=!1;function ft(t){lt||(X(),lt=!0),t.l_desc=new J(t.dyn_ltree,D),t.d_desc=new J(t.dyn_dtree,U),t.bl_desc=new J(t.bl_tree,M),t.bi_buf=0,t.bi_valid=0,Y(t)}function ht(t,e,n,r){K(t,(c<<1)+(r?1:0),3),tt(t,e,n,!0)}function pt(t){K(t,l<<1,3),H(t,O,z),$(t)}function dt(t,e,n,r){var o,a,u=0;t.level>0?(t.strm.data_type===s&&(t.strm.data_type=ct(t)),it(t,t.l_desc),it(t,t.d_desc),u=st(t),o=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=o&&(o=a)):o=a=n+5,n+4<=o&&-1!==e?ht(t,e,n,r):t.strategy===i||a===o?(K(t,(l<<1)+(r?1:0),3),rt(t,z,C)):(K(t,(f<<1)+(r?1:0),3),ut(t,t.l_desc.max_code+1,t.d_desc.max_code+1,u+1),rt(t,t.dyn_ltree,t.dyn_dtree)),Y(t),r&&V(t)}function yt(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(B[n]+y+1)]++,t.dyn_dtree[2*Z(e)]++),t.last_lit===t.lit_bufsize-1}e._tr_init=ft,e._tr_stored_block=ht,e._tr_flush_block=dt,e._tr_tally=yt,e._tr_align=pt},"2ceb":function(t,e,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},4126:function(t,e,n){"use strict";var r=n("a177"),i=n("be7f"),o=n("7b27"),a=n("4dc6"),s=n("8936"),u=Object.prototype.toString,c=0,l=4,f=0,h=1,p=2,d=-1,y=0,b=8;function v(t){if(!(this instanceof v))return new v(t);this.options=i.assign({level:d,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:y,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==f)throw new Error(a[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var c;if(c="string"===typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,n=r.deflateSetDictionary(this.strm,c),n!==f)throw new Error(a[n]);this._dict_set=!0}}function m(t,e){var n=new v(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}function g(t,e){return e=e||{},e.raw=!0,m(t,e)}function _(t,e){return e=e||{},e.gzip=!0,m(t,e)}v.prototype.push=function(t,e){var n,a,s=this.strm,d=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?l:c,"string"===typeof t?s.input=o.string2buf(t):"[object ArrayBuffer]"===u.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(d),s.next_out=0,s.avail_out=d),n=r.deflate(s,a),n!==h&&n!==f)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||a!==l&&a!==p)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&n!==h);return a===l?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===f):a!==p||(this.onEnd(f),s.avail_out=0,!0)},v.prototype.onData=function(t){this.chunks.push(t)},v.prototype.onEnd=function(t){t===f&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=v,e.deflate=m,e.deflateRaw=g,e.gzip=_},"4dc6":function(t,e,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},6853:function(t,e,n){"use strict";var r=n("be7f"),i=15,o=852,a=592,s=0,u=1,c=2,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,n,d,y,b,v,m){var g,_,w,k,O,S,x,P,j,R=m.bits,A=0,T=0,E=0,z=0,C=0,I=0,B=0,N=0,D=0,U=0,M=null,L=0,q=new r.Buf16(i+1),J=new r.Buf16(i+1),Z=null,F=0;for(A=0;A<=i;A++)q[A]=0;for(T=0;T<d;T++)q[e[n+T]]++;for(C=R,z=i;z>=1;z--)if(0!==q[z])break;if(C>z&&(C=z),0===z)return y[b++]=20971520,y[b++]=20971520,m.bits=1,0;for(E=1;E<z;E++)if(0!==q[E])break;for(C<E&&(C=E),N=1,A=1;A<=i;A++)if(N<<=1,N-=q[A],N<0)return-1;if(N>0&&(t===s||1!==z))return-1;for(J[1]=0,A=1;A<i;A++)J[A+1]=J[A]+q[A];for(T=0;T<d;T++)0!==e[n+T]&&(v[J[e[n+T]]++]=T);if(t===s?(M=Z=v,S=19):t===u?(M=l,L-=257,Z=f,F-=257,S=256):(M=h,Z=p,S=-1),U=0,T=0,A=E,O=b,I=C,B=0,w=-1,D=1<<C,k=D-1,t===u&&D>o||t===c&&D>a)return 1;for(;;){x=A-B,v[T]<S?(P=0,j=v[T]):v[T]>S?(P=Z[F+v[T]],j=M[L+v[T]]):(P=96,j=0),g=1<<A-B,_=1<<I,E=_;do{_-=g,y[O+(U>>B)+_]=x<<24|P<<16|j|0}while(0!==_);g=1<<A-1;while(U&g)g>>=1;if(0!==g?(U&=g-1,U+=g):U=0,T++,0===--q[A]){if(A===z)break;A=e[n+v[T]]}if(A>C&&(U&k)!==w){0===B&&(B=C),O+=E,I=A-B,N=1<<I;while(I+B<z){if(N-=q[I+B],N<=0)break;I++,N<<=1}if(D+=1<<I,t===u&&D>o||t===c&&D>a)return 1;w=U&k,y[w]=C<<24|I<<16|O-b|0}}return 0!==U&&(y[O+U]=A-B<<24|64<<16|0),m.bits=C,0}},"6a5d":function(t,e,n){"use strict";n.r(e);var r=n("ba10");function i(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"abcdefghijklmnopqrstuvwxyz0123456789",n="",r=e.length,i=0;i<t;i++)n+=e.charAt(Math.floor(Math.random()*r));return n}function o(t){return t.match(/([^:]*):(.*)/).slice(1,3)}function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise((function(e){setTimeout((function(){return e()}),t)}))}function s(t){var e=i(8);return new Promise((function(n){var r=function e(r){var i=r.data;i.trackingId===t.trackingId&&(self.removeEventListener("message",e),n(i.data))};self.addEventListener("message",r),t.trackingId=e,self.postMessage(t)}))}function u(t){return u="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function c(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=h(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function l(t){return d(t)||p(t)||h(t)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(t,e){if(t){if("string"===typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}function p(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function d(t){if(Array.isArray(t))return y(t)}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e,n){return e&&v(t.prototype,e),n&&v(t,n),t}function g(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}function _(t,e){return _=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_(t,e)}function w(t){var e=S();return function(){var n,r=x(t);if(e){var i=x(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k(this,n)}}function k(t,e){if(e&&("object"===u(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return O(t)}function O(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function S(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function x(t){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},x(t)}var P=function(t){g(n,t);var e=w(n);function n(){var t;return b(this,n),t=e.call(this),t.pairs=[],t.products=null,t.keepAliveIntervals={},t.apis=[],t.connecting={},t.disconnecting={},t.scheduledOperations={},t.scheduledOperationsDelays={},t.clearReconnectionDelayTimeout={},t.count=0,t}return m(n,[{key:"requiresProducts",get:function(){return!this.products&&this.endpoints.PRODUCTS}},{key:"isMatching",value:function(t){return!(!this.products||!this.products.length)&&-1!==this.products.indexOf(t)}},{key:"getUrl",value:function(t){throw new Error("Not implemented")}},{key:"link",value:async function(t){if(t=t.replace(/[^:]*:/,""),!this.isMatching(t))return Promise.reject("".concat(this.id," couldn't match with ").concat(t));this.resolveApi(t)}},{key:"resolveApi",value:function(t){var e=this,n=this.getActiveApiByUrl(this.getUrl(t));if(n||(n=this.createWs(t)),-1===n._pending.indexOf(t)&&-1===n._connected.indexOf(t))return n._pending.push(t),n.readyState===WebSocket.OPEN&&this.schedule((function(){e.subscribePendingPairs(n)}),"subscribe-"+n.url,1e3),n}},{key:"createWs",value:function(t){var e=this,n=this.getUrl(t),r=new WebSocket(n);return r._id=i(),r.binaryType="arraybuffer",r._connected=[],r._pending=[],this.apis.push(r),r.onmessage=function(t){e.count++,!0===e.onMessage(t,r)&&(r._timestamp=Date.now())},r.onopen=function(t){"undefined"!==typeof e.scheduledOperationsDelays[n]&&(e.clearReconnectionDelayTimeout[n]=setTimeout((function(){delete e.clearReconnectionDelayTimeout[n],delete e.scheduledOperationsDelays[n],r._reconnecting=!1}),1e4)),e.markLoadingAsCompleted(e.connecting,n,!0),e.subscribePendingPairs(r),e.onOpen(t,r._connected)},r.onclose=async function(t){e.clearReconnectionDelayTimeout[n]&&(clearTimeout(e.clearReconnectionDelayTimeout[n]),delete e.clearReconnectionDelayTimeout[n]),e.markLoadingAsCompleted(e.connecting,n,!1),e.onClose(t,r._connected),e.markLoadingAsCompleted(e.disconnecting,n,!0);var i=[].concat(l(r._pending),l(r._connected));if(i.length){var o=r._connected.slice();if(o.length){var a,s=c(o);try{for(s.s();!(a=s.n()).done;){var u=a.value;await e.unlink(e.id+":"+u)}}catch(f){s.e(f)}finally{s.f()}}r._reconnecting=!0,e.scheduledOperationsDelays[r.url]=e.schedule((function(){e.reconnectPairs(i)}),r.url,500,1.5,6e4)}},r.onerror=function(t){e.onError(t,r._connected)},this.connecting[n]={},this.connecting[n].promise=new Promise((function(t,i){e.connecting[n].resolver=function(n){n?(e.onApiCreated(r),t(r)):i()}})),r}},{key:"subscribePendingPairs",value:async function(t){var e,n=t._pending.slice(),r=c(n);try{for(r.s();!(e=r.n()).done;){var i=e.value;await this.subscribe(t,i)}}catch(o){r.e(o)}finally{r.f()}}},{key:"unlink",value:async function(t){t=t.replace(/[^:]*:/,"");var e=this.getActiveApiByPair(t);if(e&&-1!==e._pending.indexOf(t))return await this.unsubscribe(e,t),e._connected.length?void 0:this.removeWs(e)}},{key:"getActiveApiByPair",value:function(t){for(var e=0;e<this.apis.length;e++)if(-1!==this.apis[e]._connected.indexOf(t))return this.apis[e]}},{key:"getActiveApiByUrl",value:function(t){for(var e=0;e<this.apis.length;e++)if(this.apis[e].url===t&&(!this.maxConnectionsPerApi||this.apis[e]._connected.length+this.apis[e]._pending.length<this.maxConnectionsPerApi))return this.apis[e]}},{key:"removeWs",value:function(t){var e,n=this;if(t.readyState!==WebSocket.CLOSED){if(t._connected.length)throw new Error("Cannot unbind api that still has pairs linked to it");this.disconnecting[t.url]={},this.disconnecting[t.url].promise=new Promise((function(e,r){t.readyState<WebSocket.CLOSING&&t.close(),n.disconnecting[t.url].resolver=function(t){return t?e():r()}})),e=this.disconnecting[t.url].promise}else e=Promise.resolve();return e.then((function(){n.onApiRemoved(t),n.apis.splice(n.apis.indexOf(t),1)}))}},{key:"reconnectApi",value:function(t){var e=[].concat(l(t._pending),l(t._connected));this.reconnectPairs(e)}},{key:"reconnectPairs",value:async function(t){var e,n=t.slice(0,t.length),r=c(n);try{for(r.s();!(e=r.n()).done;){var i=e.value;await this.unlink(this.id+":"+i)}}catch(u){r.e(u)}finally{r.f()}await new Promise((function(t){return setTimeout(t,500)}));var o,a=c(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;await this.link(this.id+":"+s)}}catch(u){a.e(u)}finally{a.f()}}},{key:"setProducts",value:function(t){if(!t)return this.products=null,null;if(!this.validateProducts(t))return this.products=null,!1;if("object"===u(t)&&Object.prototype.hasOwnProperty.call(t,"products"))for(var e in t)this[e]=t[e];else Array.isArray(t)&&(this.products=t);return!0}},{key:"getProducts",value:async function(t){var e=await s({op:"getExchangeProducts",data:{exchangeId:this.id,endpoints:this.endpoints.PRODUCTS,forceFetch:t}});if(!1===this.setProducts(e.data))return this.getProducts(!0)}},{key:"onOpen",value:function(t,e){this.emit("open",t)}},{key:"onApiCreated",value:function(t){}},{key:"onApiRemoved",value:function(t){}},{key:"onMessage",value:function(t,e){throw new Error("Not implemented")}},{key:"onError",value:function(t,e){this.emit("error",t)}},{key:"onClose",value:function(t,e){this.emit("close",t)}},{key:"formatProducts",value:function(t){return t}},{key:"validateProducts",value:function(t){return!0}},{key:"subscribe",value:async function(t,e){return!!this.markPairAsConnected(t,e)&&(this.emit("subscribed",e,t._reconnecting),t.readyState===WebSocket.OPEN)}},{key:"unsubscribe",value:async function(t,e){return!!this.markPairAsDisconnected(t,e)&&(this.emit("unsubscribed",e,t._id),t.readyState===WebSocket.OPEN&&t.readyState===WebSocket.OPEN)}},{key:"emitTrades",value:function(t,e){if(e&&e.length)return this.emit("trades",e),!0}},{key:"emitLiquidations",value:function(t,e){if(e&&e.length)return this.emit("liquidations",e),!0}},{key:"startKeepAlive",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{event:"ping"},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;this.keepAliveIntervals[t.url]&&this.stopKeepAlive(t),this.keepAliveIntervals[t.url]=setInterval((function(){t.readyState===WebSocket.OPEN&&t.send(JSON.stringify(e))}),n)}},{key:"stopKeepAlive",value:function(t){this.keepAliveIntervals[t.url]&&(clearInterval(this.keepAliveIntervals[t.url]),delete this.keepAliveIntervals[t.url])}},{key:"markLoadingAsCompleted",value:function(t,e,n){t[e]&&(t[e].resolver(n),delete t[e])}},{key:"schedule",value:function(t,e,n,r,i,o){var a=this;return this.scheduledOperations[e]&&clearTimeout(this.scheduledOperations[e]),"undefined"===typeof o&&(o=this.scheduledOperationsDelays[e]),o=Math.max(n,o||0),this.scheduledOperations[e]=setTimeout((function(){delete a.scheduledOperations[e],t()}),o),o*=r||1,"number"===typeof i&&n>0&&(o=Math.min(i,o)),o}},{key:"markPairAsConnected",value:function(t,e){var n=t._pending.indexOf(e);if(-1===n)return!1;t._pending.splice(n,1);var r=t._connected.indexOf(e);return-1===r&&(t._connected.push(e),!0)}},{key:"markPairAsDisconnected",value:function(t,e){var n=t._pending.indexOf(e);if(-1!==n)return t._pending.splice(n,1),!1;var r=t._connected.indexOf(e);return-1!==r&&(t._connected.splice(r,1),!0)}}]),n}(r["EventEmitter"]),j=P;function R(t){return R="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function A(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=T(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function T(t,e){if(t){if("string"===typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function I(t,e,n){return e&&C(t.prototype,e),n&&C(t,n),t}function B(t,e,n){return B="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=N(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},B(t,e,n||t)}function N(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=Z(t),null===t)break;return t}function D(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&U(t,e)}function U(t,e){return U=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},U(t,e)}function M(t){var e=J();return function(){var n,r=Z(t);if(e){var i=Z(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return L(this,n)}}function L(t,e){if(e&&("object"===R(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return q(t)}function q(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function J(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Z(t){return Z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Z(t)}var F=function(t){D(n,t);var e=M(n);function n(){var t;return z(this,n),t=e.apply(this,arguments),t.id="BITMEX",t.xbtPrice=48e3,t.endpoints={PRODUCTS:"https://www.bitmex.com/api/v1/instrument/active"},t}return I(n,[{key:"getUrl",value:function(){return"wss://www.bitmex.com/realtime"}},{key:"formatProducts",value:function(t){var e,n=[],r={},i={},o={},a=A(t);try{for(a.s();!(e=a.n()).done;){var s=e.value;r[s.symbol]=s.isInverse?"inverse":s.isQuanto?"quanto":"linear",i[s.symbol]=s.multiplier,"linear"===r[s.symbol]&&(o[s.symbol]=s.underlyingToPositionMultiplier),n.push(s.symbol)}}catch(u){a.e(u)}finally{a.f()}return{products:n,types:r,multipliers:i,underlyingToPositionMultipliers:o}}},{key:"validateProducts",value:function(t){return!!(t&&t.multipliers&&t.underlyingToPositionMultipliers&&t.types)}},{key:"subscribe",value:async function(t,e){if(await B(Z(n.prototype),"subscribe",this).call(this,t,e))return t.send(JSON.stringify({op:"subscribe",args:["trade:"+e,"liquidation:"+e]})),!0}},{key:"unsubscribe",value:async function(t,e){if(await B(Z(n.prototype),"unsubscribe",this).call(this,t,e))return t.send(JSON.stringify({op:"subscribe",args:["trade:"+e,"liquidation:"+e]})),!0}},{key:"onApiCreated",value:function(t){t.send(JSON.stringify({op:"subscribe",args:["instrument:XBTUSD"]}))}},{key:"onMessage",value:function(t,e){var n=this,r=JSON.parse(t.data);if(r&&r.data&&r.data.length){if("liquidation"===r.table&&"insert"===r.action)return this.emitLiquidations(e.id,r.data.map((function(t){var e;return e="quanto"===n.types[t.symbol]?n.multipliers[t.symbol]/1e8*t.leavesQty*n.xbtPrice:"inverse"===n.types[t.symbol]?t.leavesQty/t.price:1/n.underlyingToPositionMultipliers[t.symbol]*t.leavesQty,{exchange:n.id,pair:t.symbol,timestamp:Date.now(),price:t.price,size:e,side:"Buy"===t.side?"buy":"sell",liquidation:!0}})));if("trade"===r.table&&"insert"===r.action)return this.emitTrades(e.id,r.data.map((function(t){return{exchange:n.id,pair:t.symbol,timestamp:+new Date(t.timestamp),price:t.price,size:t.homeNotional,side:"Buy"===t.side?"buy":"sell"}})));"instrument"===r.table&&r.data[0].lastPrice&&(this.xbtPrice=r.data[0].lastPrice)}}}]),n}(j);function K(t){return K="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function H(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=G(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function G(t,e){if(t){if("string"===typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(t,e):void 0}}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function W(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function X(t,e,n){return e&&Q(t.prototype,e),n&&Q(t,n),t}function Y(t,e,n){return Y="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=V(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},Y(t,e,n||t)}function V(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=at(t),null===t)break;return t}function tt(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&et(t,e)}function et(t,e){return et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},et(t,e)}function nt(t){var e=ot();return function(){var n,r=at(t);if(e){var i=at(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return rt(this,n)}}function rt(t,e){if(e&&("object"===K(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return it(t)}function it(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ot(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function at(t){return at=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},at(t)}var st=function(t){tt(n,t);var e=nt(n);function n(){var t;return W(this,n),t=e.apply(this,arguments),t.id="BINANCE_FUTURES",t.lastSubscriptionId=0,t.subscriptions={},t.maxConnectionsPerApi=100,t.endpoints={PRODUCTS:["https://fapi.binance.com/fapi/v1/exchangeInfo","https://dapi.binance.com/dapi/v1/exchangeInfo"]},t}return X(n,[{key:"getUrl",value:function(t){return this.dapi[t]?"wss://dstream.binance.com/ws":"wss://fstream.binance.com/ws"}},{key:"formatProducts",value:function(t){var e,n=[],r={},i={},o=H(t);try{for(o.s();!(e=o.n()).done;){var a,s=e.value,u=["fapi","dapi"][t.indexOf(s)],c=H(s.symbols);try{for(c.s();!(a=c.n()).done;){var l=a.value;if(!(l.contractStatus&&"TRADING"!==l.contractStatus||l.status&&"TRADING"!==l.status)){var f=l.symbol.toLowerCase();"dapi"===u&&(i[f]=!0),l.contractSize&&(r[f]=l.contractSize),n.push(f)}}}catch(h){c.e(h)}finally{c.f()}}}catch(h){o.e(h)}finally{o.f()}return{products:n,specs:r,dapi:i}}},{key:"subscribe",value:async function(t,e){if(await Y(at(n.prototype),"subscribe",this).call(this,t,e)){this.subscriptions[e]=++this.lastSubscriptionId;var r=[e+"@trade",e+"@forceOrder"];return t.send(JSON.stringify({method:"SUBSCRIBE",params:r,id:this.subscriptions[e]})),await a(250),!0}}},{key:"unsubscribe",value:async function(t,e){if(await Y(at(n.prototype),"unsubscribe",this).call(this,t,e)){var r=[e+"@trade",e+"@forceOrder"];return t.send(JSON.stringify({method:"UNSUBSCRIBE",params:r,id:this.subscriptions[e]})),delete this.subscriptions[e],await a(250),!0}}},{key:"onMessage",value:function(t,e){var n=JSON.parse(t.data);if(n){if("trade"===n.e&&"INSURANCE_FUND"!==n.X){var r=+n.q,i=n.s.toLowerCase();return"number"===typeof this.specs[i]&&(r=r*this.specs[i]/n.p),this.emitTrades(e.id,[{exchange:this.id,pair:i,timestamp:n.T,price:+n.p,size:r,side:n.m?"sell":"buy"}])}if("forceOrder"===n.e){var o=+n.o.q,a=n.o.s.toLowerCase();return"number"===typeof this.specs[a]&&(o=o*this.specs[a]/n.o.p),this.emitLiquidations(e.id,[{exchange:this.id,pair:a,timestamp:n.o.T,price:+n.o.p,size:o,side:"BUY"===n.o.S?"buy":"sell",liquidation:!0}])}}}}]),n}(j);function ut(t){return ut="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ft(t,e,n){return e&&lt(t.prototype,e),n&&lt(t,n),t}function ht(t,e,n){return ht="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=pt(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},ht(t,e,n||t)}function pt(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=_t(t),null===t)break;return t}function dt(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yt(t,e)}function yt(t,e){return yt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},yt(t,e)}function bt(t){var e=gt();return function(){var n,r=_t(t);if(e){var i=_t(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return vt(this,n)}}function vt(t,e){if(e&&("object"===ut(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return mt(t)}function mt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function _t(t){return _t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},_t(t)}var wt=function(t){dt(n,t);var e=bt(n);function n(){var t;return ct(this,n),t=e.apply(this,arguments),t.id="BINANCE_US",t.lastSubscriptionId=0,t.subscriptions={},t.endpoints={PRODUCTS:"https://api.binance.us/api/v3/exchangeInfo"},t}return ft(n,[{key:"getUrl",value:function(){return"wss://stream.binance.us:9443/ws"}},{key:"formatProducts",value:function(t){return t.symbols.filter((function(t){return"TRADING"===t.status})).map((function(t){return t.symbol.toLowerCase()}))}},{key:"subscribe",value:async function(t,e){if(await ht(_t(n.prototype),"subscribe",this).call(this,t,e)){this.subscriptions[e]=++this.lastSubscriptionId;var r=[e+"@trade"];return t.send(JSON.stringify({method:"SUBSCRIBE",params:r,id:this.subscriptions[e]})),await a(250),!0}}},{key:"unsubscribe",value:async function(t,e){if(await ht(_t(n.prototype),"unsubscribe",this).call(this,t,e)){var r=[e+"@trade"];return t.send(JSON.stringify({method:"UNSUBSCRIBE",params:r,id:this.subscriptions[e]})),delete this.subscriptions[e],new Promise((function(t){return setTimeout(t,250)}))}}},{key:"onMessage",value:function(t,e){var n=JSON.parse(t.data);if(n.E)return this.emitTrades(e.id,[{exchange:this.id,pair:n.s.toLowerCase(),timestamp:n.E,price:+n.p,size:+n.q,side:n.m?"sell":"buy"}])}}]),n}(j);function kt(t){return kt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function Ot(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=St(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function St(t,e){if(t){if("string"===typeof t)return xt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xt(t,e):void 0}}function xt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function jt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Rt(t,e,n){return e&&jt(t.prototype,e),n&&jt(t,n),t}function At(t,e,n){return At="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Tt(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},At(t,e,n||t)}function Tt(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=Dt(t),null===t)break;return t}function Et(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&zt(t,e)}function zt(t,e){return zt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},zt(t,e)}function Ct(t){var e=Nt();return function(){var n,r=Dt(t);if(e){var i=Dt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return It(this,n)}}function It(t,e){if(e&&("object"===kt(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Bt(t)}function Bt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Nt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Dt(t){return Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Dt(t)}var Ut=function(t){Et(n,t);var e=Ct(n);function n(){var t;return Pt(this,n),t=e.apply(this,arguments),t.id="KRAKEN",t.endpoints={PRODUCTS:["https://api.kraken.com/0/public/AssetPairs","https://futures.kraken.com/derivatives/api/v3/instruments"]},t}return Rt(n,[{key:"getUrl",value:function(t){return"undefined"!==typeof this.specs[t]?"wss://futures.kraken.com/ws/v1":"wss://ws.kraken.com/"}},{key:"formatProducts",value:function(t){var e,n=[],r={},i=Ot(t);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(o.instruments){var a,s=Ot(o.instruments);try{for(s.s();!(a=s.n()).done;){var u=a.value;if(u.tradeable){var c=u.symbol.toUpperCase();r[c]=u.contractSize,n.push(c)}}}catch(f){s.e(f)}finally{s.f()}}else if(o.result)for(var l in o.result)o.result[l].wsname&&n.push(o.result[l].wsname)}}catch(f){i.e(f)}finally{i.f()}return{products:n,specs:r}}},{key:"subscribe",value:async function(t,e){if(await At(Dt(n.prototype),"subscribe",this).call(this,t,e)){var r={event:"subscribe"};return"undefined"!==typeof this.specs[e]?(r.product_ids=[e],r.feed="trade"):(r.pair=[e],r.subscription={name:"trade"}),t.send(JSON.stringify(r)),!0}}},{key:"unsubscribe",value:async function(t,e){if(await At(Dt(n.prototype),"unsubscribe",this).call(this,t,e)){var r={event:"unsubscribe"};return"undefined"!==typeof this.specs[e]?(r.product_ids=[e],r.feed="trade"):(r.pair=[e],r.subscription={name:"trade"}),t.send(JSON.stringify(r)),!0}}},{key:"onMessage",value:function(t,e){var n=this,r=JSON.parse(t.data);if(r&&"heartbeat"!==r.event)return"trade"===r.feed&&r.qty?this.emitTrades(e.id,[{exchange:this.id,pair:r.product_id,timestamp:r.time,price:r.price,size:r.qty/r.price,side:r.side}]):!(!r[1]||!r[1].length)&&this.emitTrades(e.id,r[1].map((function(t){return{exchange:n.id,pair:r[3],timestamp:1e3*t[2],price:+t[0],size:+t[1],side:"b"===t[3]?"buy":"sell"}})))}},{key:"onApiCreated",value:function(t){/futures/.test(t.url)&&this.startKeepAlive(t)}},{key:"onApiRemoved",value:function(t){/futures/.test(t.url)&&this.stopKeepAlive(t)}}]),n}(j),Mt=n("d7ac"),Lt=n.n(Mt);function qt(t){return qt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qt(t)}function Jt(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Zt(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Zt(t,e){if(t){if("string"===typeof t)return Ft(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ft(t,e):void 0}}function Ft(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Kt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ht(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Gt(t,e,n){return e&&Ht(t.prototype,e),n&&Ht(t,n),t}function $t(t,e,n){return $t="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Wt(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},$t(t,e,n||t)}function Wt(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=ne(t),null===t)break;return t}function Qt(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xt(t,e)}function Xt(t,e){return Xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Xt(t,e)}function Yt(t){var e=ee();return function(){var n,r=ne(t);if(e){var i=ne(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vt(this,n)}}function Vt(t,e){if(e&&("object"===qt(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return te(t)}function te(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ee(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function ne(t){return ne=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ne(t)}var re=function(t){Qt(n,t);var e=Yt(n);function n(){var t;return Kt(this,n),t=e.apply(this,arguments),t.id="HUOBI",t.endpoints={PRODUCTS:["https://api.huobi.pro/v1/common/symbols","https://api.hbdm.com/api/v1/contract_contract_info","https://api.hbdm.com/swap-api/v1/swap_contract_info"]},t.contractTypesAliases={this_week:"CW",next_week:"NW",quarter:"CQ",next_quarter:"NQ"},t.types={},t.specs={},t}return Gt(n,[{key:"getUrl",value:function(t){return"futures"===this.types[t]?"wss://www.hbdm.com/ws":"swap"===this.types[t]?"wss://api.hbdm.com/swap-ws":"wss://api.huobi.pro/ws"}},{key:"formatProducts",value:function(t){var e,n=this,r=[],i={},o={},a=Jt(t);try{for(a.s();!(e=a.n()).done;){var s,u=e.value,c=["spot","futures","swap"][t.indexOf(u)],l=Jt(u.data);try{var f=function(){var t=s.value,e=void 0;switch(c){case"spot":e=(t["base-currency"]+t["quote-currency"]).toLowerCase();break;case"futures":e=t.symbol+"_"+n.contractTypesAliases[t.contract_type],i[e]=t.contract_size;break;case"swap":e=t.contract_code,i[e]=t.contract_size;break}if(r.find((function(t){return t.toLowerCase()===e.toLowerCase()})))throw new Error("Duplicate pair detected on huobi exchange ("+e+")");o[e]=c,r.push(e)};for(l.s();!(s=l.n()).done;)f()}catch(h){l.e(h)}finally{l.f()}}}catch(h){a.e(h)}finally{a.f()}return{products:r,specs:i,types:o}}},{key:"subscribe",value:async function(t,e){if(await $t(ne(n.prototype),"subscribe",this).call(this,t,e))return t.send(JSON.stringify({sub:"market.".concat(e,".trade.detail"),id:e})),t.send(JSON.stringify({sub:"public.".concat(e,".liquidation_orders"),id:e})),!0}},{key:"unsubscribe",value:async function(t,e){if(await $t(ne(n.prototype),"unsubscribe",this).call(this,t,e))return t.send(JSON.stringify({unsub:"market."+e+".trade.detail",id:e})),t.send(JSON.stringify({unsub:"public.".concat(e,".liquidation_orders"),id:e})),!0}},{key:"onMessage",value:function(t,e){var n=this,r=JSON.parse(Lt.a.inflate(t.data,{to:"string"}));if(r)if(r.ping)e.send(JSON.stringify({pong:r.ping}));else if(r.tick&&r.tick.data&&r.tick.data.length){var i=r.ch.replace(/market.(.*).trade.detail/,"$1"),o=this.id;return this.emitTrades(e.id,r.tick.data.map((function(t){var e=+t.amount;return"number"===typeof n.specs[i]&&(e=e*n.specs[i]/t.price),{exchange:o,pair:i,timestamp:t.ts,price:+t.price,size:e,side:t.direction}}))),!0}}}]),n}(j);function ie(t){return ie="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ie(t)}function oe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ae(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function se(t,e,n){return e&&ae(t.prototype,e),n&&ae(t,n),t}function ue(t,e,n){return ue="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=ce(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},ue(t,e,n||t)}function ce(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=be(t),null===t)break;return t}function le(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fe(t,e)}function fe(t,e){return fe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},fe(t,e)}function he(t){var e=ye();return function(){var n,r=be(t);if(e){var i=be(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return pe(this,n)}}function pe(t,e){if(e&&("object"===ie(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return de(t)}function de(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ye(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function be(t){return be=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},be(t)}var ve=function(t){le(n,t);var e=he(n);function n(){var t;return oe(this,n),t=e.apply(this,arguments),t.id="BINANCE",t.lastSubscriptionId=0,t.subscriptions={},t.endpoints={PRODUCTS:"https://api.binance.com/api/v3/exchangeInfo"},t}return se(n,[{key:"getUrl",value:function(){return"wss://stream.binance.com:9443/ws"}},{key:"formatProducts",value:function(t){return t.symbols.filter((function(t){return"TRADING"===t.status})).map((function(t){return t.symbol.toLowerCase()}))}},{key:"subscribe",value:async function(t,e){if(await ue(be(n.prototype),"subscribe",this).call(this,t,e)){this.subscriptions[e]=++this.lastSubscriptionId;var r=[e+"@trade"];return t.send(JSON.stringify({method:"SUBSCRIBE",params:r,id:this.subscriptions[e]})),await a(250),!0}}},{key:"unsubscribe",value:async function(t,e){if(await ue(be(n.prototype),"unsubscribe",this).call(this,t,e)){var r=[e+"@trade"];return t.send(JSON.stringify({method:"UNSUBSCRIBE",params:r,id:this.subscriptions[e]})),delete this.subscriptions[e],new Promise((function(t){return setTimeout(t,250)}))}}},{key:"onMessage",value:function(t,e){var n=JSON.parse(t.data);if(n.E)return this.emitTrades(e.id,[{exchange:this.id,pair:n.s.toLowerCase(),timestamp:n.E,price:+n.p,size:+n.q,side:n.m?"sell":"buy"}])}}]),n}(j);function me(t){return me="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},me(t)}function ge(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=_e(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _e(t,e){if(t){if("string"===typeof t)return we(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?we(t,e):void 0}}function we(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Oe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Se(t,e,n){return e&&Oe(t.prototype,e),n&&Oe(t,n),t}function xe(t,e,n){return xe="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Pe(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},xe(t,e,n||t)}function Pe(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=Ce(t),null===t)break;return t}function je(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Re(t,e)}function Re(t,e){return Re=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Re(t,e)}function Ae(t){var e=ze();return function(){var n,r=Ce(t);if(e){var i=Ce(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Te(this,n)}}function Te(t,e){if(e&&("object"===me(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ee(t)}function Ee(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ze(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Ce(t){return Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ce(t)}var Ie=function(t){je(n,t);var e=Ae(n);function n(){var t;return ke(this,n),t=e.apply(this,arguments),t.id="BITFINEX",t.maxConnectionsPerApi=24,t.channels={},t.prices={},t.endpoints={PRODUCTS:"https://api.bitfinex.com/v1/symbols"},t}return Se(n,[{key:"getUrl",value:function(){return"wss://api-pub.bitfinex.com/ws/2/"}},{key:"formatProducts",value:function(t){return t.map((function(t){return t.toUpperCase()}))}},{key:"subscribe",value:async function(t,e){if(await xe(Ce(n.prototype),"subscribe",this).call(this,t,e))return t.send(JSON.stringify({event:"subscribe",channel:"trades",symbol:"t"+e})),1===t._connected.length&&t.send(JSON.stringify({event:"subscribe",channel:"status",key:"liq:global"})),!0}},{key:"unsubscribe",value:async function(t,e){var r=this;if(await xe(Ce(n.prototype),"unsubscribe",this).call(this,t,e)){if(0===t._connected.length){var i=Object.keys(this.channels).find((function(t){return"status"===r.channels[t].name}));return i&&(t.send(JSON.stringify({event:"unsubscribe",chanId:i})),delete this.channels[i]),!0}var o=Object.keys(this.channels).filter((function(t){return r.channels[t].pair===e}));if(o.length){var a,s=ge(o);try{for(s.s();!(a=s.n()).done;){var u=a.value;t.send(JSON.stringify({event:"unsubscribe",chanId:u})),delete this.channels[u]}}catch(c){s.e(c)}finally{s.f()}}}}},{key:"onMessage",value:function(t,e){var n=this,r=JSON.parse(t.data);if("subscribed"===r.event&&r.chanId)this.channels[r.chanId]={name:r.channel,pair:r.pair};else if(this.channels[r[0]]&&"hb"!==r[1]){var i=this.channels[r[0]];if(i.hasSentInitialMessage)return"trades"===i.name&&"te"===r[1]?(this.prices[e.id+i.pair]=+r[2][3],this.emitTrades(e.id,[{exchange:this.id,pair:i.pair,timestamp:+new Date(r[2][1]),price:+r[2][3],size:Math.abs(r[2][2]),side:r[2][2]<0?"sell":"buy"}])):"status"===i.name&&r[1]?this.emitLiquidations(e.id,r[1].filter((function(t){return-1!==e._connected.indexOf(t[4].substring(1))})).map((function(t){var r=t[4].substring(1);return{exchange:n.id,pair:t[4].substring(1),timestamp:parseInt(t[2]),price:n.prices[e.id+r],size:Math.abs(t[5]),side:t[5]>1?"sell":"buy",liquidation:!0}}))):void 0;i.hasSentInitialMessage=!0}else"hb"!==r[1]&&r.event}}]),n}(j);function Be(t){return Be="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Be(t)}function Ne(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function De(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ue(t,e,n){return e&&De(t.prototype,e),n&&De(t,n),t}function Me(t,e,n){return Me="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Le(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},Me(t,e,n||t)}function Le(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=Ge(t),null===t)break;return t}function qe(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Je(t,e)}function Je(t,e){return Je=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Je(t,e)}function Ze(t){var e=He();return function(){var n,r=Ge(t);if(e){var i=Ge(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Fe(this,n)}}function Fe(t,e){if(e&&("object"===Be(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ke(t)}function Ke(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function He(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Ge(t){return Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ge(t)}var $e=function(t){qe(n,t);var e=Ze(n);function n(){var t;return Ne(this,n),t=e.apply(this,arguments),t.id="BITSTAMP",t.endpoints={PRODUCTS:"https://www.bitstamp.net/api/v2/trading-pairs-info/"},t}return Ue(n,[{key:"getUrl",value:function(){return"wss://ws.bitstamp.net/"}},{key:"formatProducts",value:function(t){return t.map((function(t){return t.url_symbol}))}},{key:"subscribe",value:async function(t,e){if(await Me(Ge(n.prototype),"subscribe",this).call(this,t,e))return t.send(JSON.stringify({event:"bts:subscribe",data:{channel:"live_trades_"+e}})),!0}},{key:"unsubscribe",value:async function(t,e){if(await Me(Ge(n.prototype),"unsubscribe",this).call(this,t,e))return t.send(JSON.stringify({event:"bts:unsubscribe",data:{channel:"live_trades_"+e}})),!0}},{key:"onMessage",value:function(t,e){var n=JSON.parse(t.data);if(n&&n.data&&n.data.amount){var r=n.data;return this.emitTrades(e.id,[{exchange:this.id,pair:n.channel.split("_").pop(),timestamp:+new Date(r.microtimestamp/1e3),price:r.price,size:r.amount,side:0===r.type?"buy":"sell"}])}}}]),n}(j);function We(t){return We="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},We(t)}function Qe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ye(t,e,n){return e&&Xe(t.prototype,e),n&&Xe(t,n),t}function Ve(t,e,n){return Ve="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=tn(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},Ve(t,e,n||t)}function tn(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=un(t),null===t)break;return t}function en(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nn(t,e)}function nn(t,e){return nn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},nn(t,e)}function rn(t){var e=sn();return function(){var n,r=un(t);if(e){var i=un(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return on(this,n)}}function on(t,e){if(e&&("object"===We(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return an(t)}function an(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function sn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function un(t){return un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},un(t)}var cn=function(t){en(n,t);var e=rn(n);function n(){var t;return Qe(this,n),t=e.apply(this,arguments),t.id="COINBASE",t.endpoints={PRODUCTS:"https://api.pro.coinbase.com/products"},t}return Ye(n,[{key:"getUrl",value:function(){return"wss://ws-feed.pro.coinbase.com/"}},{key:"formatProducts",value:function(t){return t.map((function(t){return t.id}))}},{key:"subscribe",value:async function(t,e){if(await Ve(un(n.prototype),"subscribe",this).call(this,t,e))return t.send(JSON.stringify({type:"subscribe",channels:[{name:"matches",product_ids:[e]}]})),!0}},{key:"unsubscribe",value:async function(t,e){if(await Ve(un(n.prototype),"unsubscribe",this).call(this,t,e))return t.send(JSON.stringify({type:"unsubscribe",channels:[{name:"matches",product_ids:[e]}]})),!0}},{key:"onMessage",value:function(t,e){var n=JSON.parse(t.data);if(n&&n.size>0)return this.emitTrades(e.id,[{exchange:this.id,pair:n.product_id,timestamp:+new Date(n.time),price:+n.price,size:+n.size,side:"buy"===n.side?"sell":"buy"}])}}]),n}(j);function ln(t){return ln="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ln(t)}function fn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function pn(t,e,n){return e&&hn(t.prototype,e),n&&hn(t,n),t}function dn(t,e,n){return dn="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=yn(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},dn(t,e,n||t)}function yn(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=kn(t),null===t)break;return t}function bn(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vn(t,e)}function vn(t,e){return vn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},vn(t,e)}function mn(t){var e=wn();return function(){var n,r=kn(t);if(e){var i=kn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return gn(this,n)}}function gn(t,e){if(e&&("object"===ln(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _n(t)}function _n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function kn(t){return kn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},kn(t)}var On=function(t){bn(n,t);var e=mn(n);function n(){var t;return fn(this,n),t=e.apply(this,arguments),t.id="HITBTC",t.endpoints={PRODUCTS:"https://api.hitbtc.com/api/2/public/symbol"},t}return pn(n,[{key:"getUrl",value:function(){return"wss://api.hitbtc.com/api/2/ws"}},{key:"formatProducts",value:function(t){return t.map((function(t){return t.id}))}},{key:"subscribe",value:async function(t,e){if(await dn(kn(n.prototype),"subscribe",this).call(this,t,e))return t.send(JSON.stringify({method:"subscribeTrades",params:{symbol:e}})),!0}},{key:"unsubscribe",value:async function(t,e){if(await dn(kn(n.prototype),"unsubscribe",this).call(this,t,e))return t.send(JSON.stringify({method:"unsubscribeTrades",params:{symbol:e}})),!0}},{key:"onMessage",value:function(t,e){var n=this,r=JSON.parse(t.data);if(r&&"updateTrades"===r.method&&r.params&&r.params.data&&r.params.data.length)return this.emitTrades(e.id,r.params.data.map((function(t){return{exchange:n.id,pair:r.params.symbol,timestamp:+new Date(t.timestamp),price:+t.price,size:+t.quantity,side:t.side}})))}}]),n}(j);function Sn(t){return Sn="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sn(t)}function xn(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Pn(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Pn(t,e){if(t){if("string"===typeof t)return jn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jn(t,e):void 0}}function jn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Rn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function An(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Tn(t,e,n){return e&&An(t.prototype,e),n&&An(t,n),t}function En(t,e,n){return En="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=zn(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},En(t,e,n||t)}function zn(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=Mn(t),null===t)break;return t}function Cn(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&In(t,e)}function In(t,e){return In=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},In(t,e)}function Bn(t){var e=Un();return function(){var n,r=Mn(t);if(e){var i=Mn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Nn(this,n)}}function Nn(t,e){if(e&&("object"===Sn(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Dn(t)}function Dn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Un(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Mn(t){return Mn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Mn(t)}var Ln=function(t){Cn(n,t);var e=Bn(n);function n(){var t;return Rn(this,n),t=e.apply(this,arguments),t.id="OKEX",t.endpoints={PRODUCTS:["https://www.okex.com/api/spot/v3/instruments","https://www.okex.com/api/futures/v3/instruments","https://www.okex.com/api/swap/v3/instruments"]},t}return Tn(n,[{key:"getUrl",value:function(){return"wss://real.okex.com:8443/ws/v3"}},{key:"formatProducts",value:function(t){var e,n=[],r={},i={},o={},a=xn(t);try{for(a.s();!(e=a.n()).done;){var s,u=e.value,c=xn(u);try{for(c.s();!(s=c.n()).done;){var l=s.value,f=l.instrument_id;l.alias?(r[f]=+l.contract_val,i[f]="futures","true"===l.is_inverse&&(o[f]=!0)):/-SWAP/.test(l.instrument_id)?(r[f]=+l.contract_val,i[f]="swap","true"===l.is_inverse&&(o[f]=!0)):i[f]="spot",n.push(f)}}catch(h){c.e(h)}finally{c.f()}}}catch(h){a.e(h)}finally{a.f()}return{products:n,specs:r,types:i,inversed:o}}},{key:"subscribe",value:async function(t,e){if(await En(Mn(n.prototype),"subscribe",this).call(this,t,e)){var r=this.types[e];return t.send(JSON.stringify({op:"subscribe",args:["".concat(r,"/trade:").concat(e)]})),!0}}},{key:"unsubscribe",value:async function(t,e){if(await En(Mn(n.prototype),"unsubscribe",this).call(this,t,e)){var r=this.types[e];return t.send(JSON.stringify({op:"unsubscribe",args:["".concat(r,"/trade:").concat(e)]})),!0}}},{key:"onMessage",value:function(t,e){var n,r=this;try{n="string"===typeof t?JSON.parse(t):JSON.parse(Lt.a.inflateRaw(t.data,{to:"string"}))}catch(i){return}if(n&&n.data&&n.data.length)return this.emitTrades(e.id,n.data.map((function(t){var e,n=r.id;return e="undefined"!==typeof r.specs[t.instrument_id]?(t.size||t.qty)*r.specs[t.instrument_id]/(r.inversed[t.instrument_id]?t.price:1):t.size,{exchange:n,pair:t.instrument_id,timestamp:+new Date(t.timestamp),price:+t.price,size:+e,side:t.side}})))}}]),n}(j);function qn(t){return qn="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qn(t)}function Jn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fn(t,e,n){return e&&Zn(t.prototype,e),n&&Zn(t,n),t}function Kn(t,e,n){return Kn="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Hn(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},Kn(t,e,n||t)}function Hn(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=Vn(t),null===t)break;return t}function Gn(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$n(t,e)}function $n(t,e){return $n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},$n(t,e)}function Wn(t){var e=Yn();return function(){var n,r=Vn(t);if(e){var i=Vn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qn(this,n)}}function Qn(t,e){if(e&&("object"===qn(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Xn(t)}function Xn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Vn(t){return Vn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Vn(t)}var tr=function(t){Gn(n,t);var e=Wn(n);function n(){var t;return Jn(this,n),t=e.apply(this,arguments),t.id="POLONIEX",t.endpoints={PRODUCTS:"https://www.poloniex.com/public?command=returnTicker"},t.channels={},t}return Fn(n,[{key:"getUrl",value:function(){return"wss://api2.poloniex.com/"}},{key:"formatProducts",value:function(t){return Object.keys(t)}},{key:"subscribe",value:async function(t,e){if(await Kn(Vn(n.prototype),"subscribe",this).call(this,t,e))return t.send(JSON.stringify({command:"subscribe",channel:e})),!0}},{key:"unsubscribe",value:async function(t,e){if(await Kn(Vn(n.prototype),"unsubscribe",this).call(this,t,e))return t.send(JSON.stringify({command:"unsubscribe",channel:e})),!0}},{key:"onMessage",value:function(t,e){var n=this,r=JSON.parse(t.data);if(r&&3===r.length&&r[2]&&r[2].length){if("i"!==r[2][0][0])return this.emitTrades(e.id,r[2].filter((function(t){return"t"===t[0]})).map((function(t){return{exchange:n.id,pair:n.channels[r[0]],timestamp:+new Date(1e3*t[5]),price:+t[3],size:+t[4],side:t[2]?"buy":"sell"}})));this.channels[r[0]]=r[2][0][1].currencyPair}}}]),n}(j);function er(t){return er="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},er(t)}function nr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ir(t,e,n){return e&&rr(t.prototype,e),n&&rr(t,n),t}function or(t,e,n){return or="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=ar(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},or(t,e,n||t)}function ar(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=pr(t),null===t)break;return t}function sr(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ur(t,e)}function ur(t,e){return ur=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ur(t,e)}function cr(t){var e=hr();return function(){var n,r=pr(t);if(e){var i=pr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return lr(this,n)}}function lr(t,e){if(e&&("object"===er(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return fr(t)}function fr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function pr(t){return pr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},pr(t)}var dr=function(t){sr(n,t);var e=cr(n);function n(){var t;return nr(this,n),t=e.apply(this,arguments),t.id="DERIBIT",t.endpoints={PRODUCTS:"https://www.deribit.com/api/v1/public/getinstruments"},t}return ir(n,[{key:"getUrl",value:function(){return"wss://www.deribit.com/ws/api/v2"}},{key:"formatProducts",value:function(t){return t.result.map((function(t){return t.instrumentName}))}},{key:"subscribe",value:async function(t,e){if(await or(pr(n.prototype),"subscribe",this).call(this,t,e))return t.send(JSON.stringify({method:"public/subscribe",params:{channels:["trades."+e+".raw"]}})),!0}},{key:"unsubscribe",value:async function(t,e){if(await or(pr(n.prototype),"unsubscribe",this).call(this,t,e))return t.send(JSON.stringify({method:"public/unsubscribe",params:{channels:["trades."+e+".raw"]}})),!0}},{key:"onMessage",value:function(t,e){var n=JSON.parse(t.data);if(n&&n.params&&n.params.data&&n.params.data.length){for(var r=[],i=[],o=0;o<n.params.data.length;o++){var a=n.params.data[o],s={exchange:this.id,pair:a.instrument_name,timestamp:+a.timestamp,price:+a.price,size:a.amount/a.price,side:a.direction};a.liquidation?(s.liquidation=!0,i.push(s)):r.push(s)}return r.length&&this.emitTrades(e.id,r),i.length&&this.emitLiquidations(e.id,i),!0}}},{key:"onApiCreated",value:function(t){this.startKeepAlive(t,{method:"public/ping"},45e3)}},{key:"onApiRemoved",value:function(t){this.stopKeepAlive(t)}}]),n}(j);function yr(t){return yr="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yr(t)}function br(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=vr(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function vr(t,e){if(t){if("string"===typeof t)return mr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mr(t,e):void 0}}function mr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function gr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wr(t,e,n){return e&&_r(t.prototype,e),n&&_r(t,n),t}function kr(t,e,n){return kr="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Or(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},kr(t,e,n||t)}function Or(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=Tr(t),null===t)break;return t}function Sr(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xr(t,e)}function xr(t,e){return xr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},xr(t,e)}function Pr(t){var e=Ar();return function(){var n,r=Tr(t);if(e){var i=Tr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return jr(this,n)}}function jr(t,e){if(e&&("object"===yr(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Rr(t)}function Rr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ar(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Tr(t){return Tr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Tr(t)}var Er=function(t){Sr(n,t);var e=Pr(n);function n(){var t;return gr(this,n),t=e.apply(this,arguments),t.id="BYBIT",t.endpoints={PRODUCTS:["https://api.bybit.com/spot/v1/symbols","https://api.bybit.com/v2/public/symbols"]},t}return wr(n,[{key:"getUrl",value:function(t){return/-SPOT$/.test(t)?"wss://stream.bybit.com/spot/quote/ws/v2":-1!==t.indexOf("USDT")?"wss://stream.bybit.com/realtime_public":"wss://stream.bybit.com/realtime"}},{key:"formatProducts",value:function(t){var e,n=[],r=br(t);try{for(r.s();!(e=r.n()).done;){var i,o=e.value,a=["spot","futures"][t.indexOf(o)],s=br(o.result);try{for(s.s();!(i=s.n()).done;){var u=i.value;if("spot"===a)n.push(u.name+"-SPOT");else{if("Trading"!==u.status)continue;n.push(u.name)}}}catch(c){s.e(c)}finally{s.f()}}}catch(c){r.e(c)}finally{r.f()}return{products:n}}},{key:"subscribe",value:async function(t,e){if(await kr(Tr(n.prototype),"subscribe",this).call(this,t,e))return/-SPOT$/.test(e)?t.send(JSON.stringify({topic:"trade",event:"sub",params:{binary:!1,symbol:e.replace(/-SPOT$/,"")}})):t.send(JSON.stringify({op:"subscribe",args:["trade."+e,"liquidation."+e]})),!0}},{key:"unsubscribe",value:async function(t,e){if(await kr(Tr(n.prototype),"unsubscribe",this).call(this,t,e))return/-SPOT$/.test(e)?t.send(JSON.stringify({topic:"trade",event:"cancel",params:{binary:!1,symbol:e.replace(/-SPOT$/,"")}})):t.send(JSON.stringify({op:"unsubscribe",args:["trade."+e,"liquidation."+e]})),!0}},{key:"onMessage",value:function(t,e){var n=this,r=JSON.parse(t.data);if(r.data&&r.topic){if(r.data.length)return this.emitTrades(e.id,r.data.map((function(t){var e=/USDT$/.test(t.symbol)?t.size:t.size/t.price;return{exchange:n.id,pair:t.symbol,timestamp:+new Date(t.timestamp),price:+t.price,size:e,side:"Buy"===t.side?"buy":"sell"}})));if(r.data.symbol){var i=/USDT$/.test(r.data.symbol)?+r.data.qty:r.data.qty/r.data.price;return this.emitLiquidations(e.id,[{exchange:this.id,pair:r.data.symbol,timestamp:+r.data.time,price:+r.data.price,size:i,side:"Buy"===r.data.side?"sell":"buy",liquidation:!0}])}return this.emitTrades(e.id,[{exchange:this.id,pair:r.params.symbol+"-SPOT",timestamp:+r.data.t,price:+r.data.p,size:+r.data.q,side:r.data.m?"buy":"sell"}])}}},{key:"onApiCreated",value:function(t){this.startKeepAlive(t,{op:"ping"},45e3)}},{key:"onApiRemoved",value:function(t){this.stopKeepAlive(t)}}]),n}(j);function zr(t){return zr="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zr(t)}function Cr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ir(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Br(t,e,n){return e&&Ir(t.prototype,e),n&&Ir(t,n),t}function Nr(t,e,n){return Nr="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Dr(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},Nr(t,e,n||t)}function Dr(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=Fr(t),null===t)break;return t}function Ur(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mr(t,e)}function Mr(t,e){return Mr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Mr(t,e)}function Lr(t){var e=Zr();return function(){var n,r=Fr(t);if(e){var i=Fr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return qr(this,n)}}function qr(t,e){if(e&&("object"===zr(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Jr(t)}function Jr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Zr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Fr(t){return Fr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Fr(t)}var Kr=function(t){Ur(n,t);var e=Lr(n);function n(){var t;return Cr(this,n),t=e.apply(this,arguments),t.id="FTX",t.endpoints={PRODUCTS:"https://ftx.com/api/markets"},t}return Br(n,[{key:"getUrl",value:function(){return"wss://ftx.com/ws/"}},{key:"formatProducts",value:function(t){return t.result.map((function(t){return t.name}))}},{key:"subscribe",value:async function(t,e){if(await Nr(Fr(n.prototype),"subscribe",this).call(this,t,e))return t.send(JSON.stringify({op:"subscribe",channel:"trades",market:e})),!0}},{key:"unsubscribe",value:async function(t,e){if(await Nr(Fr(n.prototype),"unsubscribe",this).call(this,t,e))return t.send(JSON.stringify({op:"unsubscribe",channel:"trades",market:e})),!0}},{key:"onMessage",value:function(t,e){var n=JSON.parse(t.data);if(n&&n.data&&n.data.length){for(var r=[],i=[],o=0;o<n.data.length;o++){var a={exchange:this.id,pair:n.market,timestamp:+new Date(n.data[o].time),price:+n.data[o].price,size:n.data[o].size,side:n.data[o].side};n.data[o].liquidation?(a.liquidation=!0,i.push(a)):r.push(a)}return r.length&&this.emitTrades(e.id,r),i.length&&this.emitLiquidations(e.id,i),!0}}},{key:"onApiCreated",value:function(t){this.startKeepAlive(t,{op:"ping"},15e3)}},{key:"onApiRemoved",value:function(t){this.stopKeepAlive(t)}}]),n}(j);function Hr(t){return Hr="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hr(t)}function Gr(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=$r(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function $r(t,e){if(t){if("string"===typeof t)return Wr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wr(t,e):void 0}}function Wr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Qr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Yr(t,e,n){return e&&Xr(t.prototype,e),n&&Xr(t,n),t}function Vr(t,e,n){return Vr="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=ti(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},Vr(t,e,n||t)}function ti(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=si(t),null===t)break;return t}function ei(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ni(t,e)}function ni(t,e){return ni=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ni(t,e)}function ri(t){var e=ai();return function(){var n,r=si(t);if(e){var i=si(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ii(this,n)}}function ii(t,e){if(e&&("object"===Hr(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return oi(t)}function oi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ai(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function si(t){return si=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},si(t)}var ui=function(t){ei(n,t);var e=ri(n);function n(){var t;return Qr(this,n),t=e.apply(this,arguments),t.id="PHEMEX",t.leverages=[],t.currencies=[],t.riskLimits=[],t.specs={},t.endpoints={PRODUCTS:"https://api.phemex.com/exchange/public/cfg/v2/products"},t.channels={},t}return Yr(n,[{key:"getUrl",value:function(){return"wss://phemex.com/ws"}},{key:"formatProducts",value:function(t){var e,n={},r=[],i=t.data.leverages,o=t.data.currencies,a=t.data.riskLimits,s=Gr(t.data.products);try{var u=function(){var i=e.value;"Perpetual"===i.type?n[i.symbol]={type:i.type,contractSize:i.contractSize,settleCurrency:i.settleCurrency,quoteCurrency:i.quoteCurrency,valueScale:o.filter((function(t){return t.currency===i.settleCurrency}))[0].valueScale,priceScale:o.filter((function(t){return t.currency===i.quoteCurrency}))[0].valueScale,ratioScale:t.data.ratioScale,riskLimits:a.filter((function(t){return t.symbol===i.symbol})).map((function(t){return{steps:t.steps,riskLimits:t.riskLimits}})),minPriceEp:i.minPricEp,maxPriceEp:i.maxPriceEp,lotSize:i.lotSize,pricePrecision:i.pricePrecision,maxOrderQty:i.maxOrderQty}:"Spot"===i.type&&(n[i.symbol]={type:i.type,maxBaseOrderSizeEv:i.maxBaseOrderSizeEv,minOrderValueEv:i.minOrderValueEv,valueScale:o.filter((function(t){return t.currency===i.quoteCurrency}))[0].valueScale,priceScale:o.filter((function(t){return t.currency===i.baseCurrency}))[0].valueScale,ratioScale:t.data.ratioScale}),r.push(i.symbol)};for(s.s();!(e=s.n()).done;)u()}catch(c){s.e(c)}finally{s.f()}return{specs:n,products:r,leverages:i,currencies:o,riskLimits:a}}},{key:"subscribe",value:async function(t,e){if(await Vr(si(n.prototype),"subscribe",this).call(this,t,e))return t.send(JSON.stringify({id:1234,method:"trade.subscribe",params:[e]})),!0}},{key:"unsubscribe",value:async function(t,e){if(await Vr(si(n.prototype),"unsubscribe",this).call(this,t,e))return t.send(JSON.stringify({id:1234,method:"trade.unsubscribe",params:[e]})),!0}},{key:"onMessage",value:function(t,e){var n=this,r=JSON.parse(t.data);if(void 0!==r.trades&&"incremental"===r.type){var i=this.specs[r.symbol].type,o=r.trades.map((function(t){var e={exchange:n.id,pair:r.symbol,timestamp:t[0]/1e6,side:"Buy"===t[1]?"buy":"sell",price:0,size:0};return"Perpetual"===i?(e.price=+t[2]/Math.pow(10,n.specs[r.symbol].priceScale),e.size=+t[3]*n.specs[r.symbol].contractSize,n.specs[r.symbol].settleCurrency!==n.specs[r.symbol].quoteCurrency&&(e.size/=e.price)):"Spot"===i&&(e.price=+t[2]/Math.pow(10,n.specs[r.symbol].priceScale),e.size=+t[3]/Math.pow(10,n.specs[r.symbol].valueScale)),e}));return this.emitTrades(e.id,o)}}},{key:"onApiCreated",value:function(t){this.startKeepAlive(t,{method:"server.ping",id:9e3,params:[]},5e3)}},{key:"onApiRemoved",value:function(t){this.stopKeepAlive(t)}}]),n}(j);function ci(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=li(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function li(t,e){if(t){if("string"===typeof t)return fi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fi(t,e):void 0}}function fi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var hi=[new F,new st,new wt,new Ut,new re,new ve,new Ie,new $e,new cn,new On,new Ln,new tr,new dr,new Er,new Kr,new ui];function pi(t){var e,n=ci(hi);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.id.toLowerCase()===t.toLowerCase())return r}}catch(i){n.e(i)}finally{n.f()}}function di(t,e){return vi(t)||bi(t,e)||gi(t,e)||yi()}function yi(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function bi(t,e){var n=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done);a=!0)if(o.push(r.value),e&&o.length===e)break}catch(u){s=!0,i=u}finally{try{a||null==n["return"]||n["return"]()}finally{if(s)throw i}}return o}}function vi(t){if(Array.isArray(t))return t}function mi(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=gi(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function gi(t,e){if(t){if("string"===typeof t)return _i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_i(t,e):void 0}}function _i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function wi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ki(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Oi(t,e,n){return e&&ki(t.prototype,e),n&&ki(t,n),t}var Si=self,xi=function(){function t(){wi(this,t),this.settings={calculateSlippage:null,aggregationLength:null,preferQuoteCurrencySize:null,buckets:{}},this.connections={},this.activeBuckets=[],this.buckets={},this.connectionsCount=0,this.connectionChange=0,this.onGoingAggregations={},this.pendingTrades=[],this.marketsStats={},this.bindExchanges(),this.startPriceInterval(),Si.postMessage({op:"hello"})}return Oi(t,[{key:"bindExchanges",value:function(){var t,e=mi(hi);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.on("subscribed",this.onSubscribed.bind(this,n.id)),n.on("unsubscribed",this.onUnsubscribed.bind(this,n.id)),n.on("error",this.onError.bind(this,n.id))}}catch(r){e.e(r)}finally{e.f()}}},{key:"bindTradesEvent",value:function(){var t,e=mi(hi);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.off("trades"),this.settings.aggregationLength>0?(n.on("trades",this.aggregateTrades.bind(this)),n.on("liquidations",this.aggregateLiquidations.bind(this))):(n.on("trades",this.emitTrades.bind(this)),n.on("liquidations",this.emitLiquidations.bind(this)))}}catch(r){e.e(r)}finally{e.f()}this.settings.aggregationLength>0?this.startAggrInterval():(this.clearInterval("aggr"),this.timeoutExpiredAggregations(),this.emitPendingTrades())}},{key:"updateBuckets",value:function(t){var e=[],n=[];for(var r in t){-1===e.indexOf(r)&&e.push(r),this.buckets[r]||(this.buckets[r]=this.createBucket());var i,o=mi(t[r]);try{for(o.s();!(i=o.n()).done;){var a=i.value;-1===n.indexOf(a)&&n.push(a),this.connections[a]&&(this.connections[a].bucket||(this.connections[a].bucket=this.createBucket()))}}catch(c){o.e(c)}finally{o.f()}}for(var s in this.connections)this.connections[s].bucket&&-1===n.indexOf(s)&&(this.connections[s].bucket=null);for(var u in this.buckets)-1===e.indexOf(u)&&delete this.buckets[u];e.length&&!this.activeBuckets.length?this.startStatsInterval():this.activeBuckets.length&&!e.length&&this["_statsInterval"]&&(this.clearInterval("stats"),this["_statsInterval"]=null),this.activeBuckets=e,this.settings.buckets=t}},{key:"emitTrades",value:function(t){for(var e=0;e<t.length;e++){var n=t[e],r=n.exchange+":"+n.pair;this.connections[r]&&(this.settings.calculateSlippage&&(n.originalPrice=this.marketsStats[r].price||n.price),n.count=1,this.processTrade(n))}Si.postMessage({op:"trades",data:t})}},{key:"aggregateTrades",value:function(t){for(var e=Date.now(),n=0;n<t.length;n++){var r=t[n],i=r.exchange+":"+r.pair;if(this.connections[i]){if(this.onGoingAggregations[i]){var o=this.onGoingAggregations[i];if(o.timestamp+this.settings.aggregationLength>r.timestamp&&o.side===r.side){o.size+=r.size,o.prices+=r.price*r.size,o.price=r.price,o.count++;continue}this.pendingTrades.push(this.processTrade(o))}r.originalPrice=this.marketsStats[i].price||r.price,r.count=1,r.prices=r.price*r.size,r.timeout=e+50,this.onGoingAggregations[i]=r}}}},{key:"emitLiquidations",value:function(t){for(var e=0;e<t.length;e++){var n=t[e],r=n.exchange+":"+n.pair;this.connections[r]&&this.processLiquidation(n)}Si.postMessage({op:"trades",data:t})}},{key:"aggregateLiquidations",value:function(t){for(var e=Date.now(),n=0;n<t.length;n++){var r=t[n],i=r.exchange+":"+r.pair,o="liq_"+i;if(this.connections[i]){if(this.onGoingAggregations[o]){var a=this.onGoingAggregations[o];if(a.timestamp+this.settings.aggregationLength>r.timestamp&&a.side===r.side){a.size+=r.size,a.count++;continue}this.pendingTrades.push(this.processLiquidation(a))}r.count=1,r.timeout=e+50,this.onGoingAggregations[o]=r}}}},{key:"processTrade",value:function(t){var e=t.exchange+":"+t.pair;return this.settings.calculateSlippage&&("price"===this.settings.calculateSlippage?(t.slippage=Math.round(10*(t.price-t.originalPrice+Number.EPSILON))/10,Math.abs(t.slippage)/t.price<25e-5&&(t.slippage=null)):"bps"===this.settings.calculateSlippage&&("buy"===t.side?t.slippage=Math.floor((t.price-t.originalPrice)/t.originalPrice*1e4):t.slippage=Math.floor((t.originalPrice-t.price)/t.price*1e4))),t.amount=(this.settings.preferQuoteCurrencySize?t.price:1)*t.size,this.marketsStats[e].volume+=t.amount,this.marketsStats[e].price=t.price,null===this.marketsStats[e].initialPrice&&this.emitInitialPrice(e,t.price),this.settings.aggregationLength>0&&(t.price=Math.max(t.price,t.originalPrice)),this.connections[e].bucket&&(this.connections[e].bucket["c"+t.side]+=t.count,this.connections[e].bucket["v"+t.side]+=t.amount),t}},{key:"processLiquidation",value:function(t){var e=t.exchange+":"+t.pair;return t.amount=(this.settings.preferQuoteCurrencySize?t.price:1)*t.size,this.connections[e].bucket&&(this.connections[e].bucket["l"+t.side]+=t.amount),t}},{key:"timeoutExpiredAggregations",value:function(){for(var t=Date.now(),e=Object.keys(this.onGoingAggregations),n=0;n<e.length;n++){var r=this.onGoingAggregations[e[n]];t>r.timeout&&(r.liquidation?this.pendingTrades.push(this.processLiquidation(r)):this.pendingTrades.push(this.processTrade(r)),delete this.onGoingAggregations[e[n]])}}},{key:"emitInitialPrice",value:function(t,e){this.marketsStats[t].initialPrice=e,Si.postMessage({op:"price",data:{market:t,price:e}})}},{key:"emitPendingTrades",value:function(){this.settings.aggregationLength>0&&this.timeoutExpiredAggregations(),this.pendingTrades.length&&(Si.postMessage({op:"trades",data:this.pendingTrades}),this.pendingTrades.splice(0,this.pendingTrades.length))}},{key:"emitStats",value:function(){var t=Date.now();for(var e in this.settings.buckets){var n,r=mi(this.settings.buckets[e]);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.connections[i]&&(this.buckets[e].vbuy+=this.connections[i].bucket.vbuy,this.buckets[e].vsell+=this.connections[i].bucket.vsell,this.buckets[e].cbuy+=this.connections[i].bucket.cbuy,this.buckets[e].csell+=this.connections[i].bucket.csell,this.buckets[e].lbuy+=this.connections[i].bucket.lbuy,this.buckets[e].lsell+=this.connections[i].bucket.lsell)}}catch(a){r.e(a)}finally{r.f()}this.buckets[e].timestamp=t,Si.postMessage({op:"bucket-"+e,data:this.buckets[e]}),this.clearBucket(this.buckets[e])}for(var o in this.connections)this.connections[o].bucket&&this.clearBucket(this.connections[o].bucket)}},{key:"emitPrices",value:function(){this.connectionsCount&&Si.postMessage({op:"prices",data:this.marketsStats})}},{key:"onSubscribed",value:function(t,e){var n=t+":"+e;if(!this.connections[n]){for(var r in this.connections[n]={exchange:t,pair:e,hit:0,timestamp:null},this.marketsStats[n]={volume:0,initialPrice:null,price:null},this.connectionsCount=Object.keys(this.connections).length,this.settings.buckets)if(-1!==this.settings.buckets[r].indexOf(n)){this.connections[n].bucket=this.createBucket();break}Si.postMessage({op:"connection",data:{pair:e,exchangeId:t}}),this.noticeConnectionChange(1)}}},{key:"onUnsubscribed",value:function(t,e){var n=t+":"+e;this.onGoingAggregations[n]&&delete this.onGoingAggregations[n],this.connections[n]&&(delete this.connections[n],delete this.marketsStats[n],this.connectionsCount=Object.keys(this.connections).length,Si.postMessage({op:"disconnection",data:{pair:e,exchangeId:t}}),this.noticeConnectionChange(-1))}},{key:"noticeConnectionChange",value:function(t){var e=this;this.connectionChange+=t,this._connectionChangeNoticeTimeout&&clearTimeout(this._connectionChangeNoticeTimeout),this._connectionChangeNoticeTimeout=setTimeout((function(){e._connectionChangeNoticeTimeout=null,Si.postMessage({op:"notice",data:{id:"connections",type:"success",title:e.connectionsCount+" connections ("+(e.connectionChange>0?"+":"")+e.connectionChange+")"}}),e.connectionChange=0}),3e3)}},{key:"createBucket",value:function(){return{timestamp:null,vbuy:0,vsell:0,cbuy:0,csell:0,lbuy:0,lsell:0}}},{key:"clearBucket",value:function(t){t.cbuy=t.csell=t.vbuy=t.vsell=t.lbuy=t.lsell=0}},{key:"onError",value:function(t,e){var n;"string"===typeof e?n=e:e.message&&(n=e.message),n&&Si.postMessage({op:"notice",data:{id:t+"-error",type:"error",title:"".concat(t," disconnected unexpectedly (").concat(n,")")}})}},{key:"connect",value:async function(t,e){var n=t.reduce((function(t,e){var n=o(e),r=di(n,2),i=r[0],a=r[1];return i&&a?(t[i]||(t[i]=[]),-1===t[i].indexOf(e)&&t[i].push(e),t):{}}),{}),r=[],i=async function(t){var e=pi(t);e&&(e.requiresProducts&&await e.getProducts(),r.push(async function(){var r,i=mi(n[t]);try{for(i.s();!(r=i.n()).done;){var o=r.value;await e.link(o)}}catch(a){i.e(a)}finally{i.f()}}()))};for(var a in n)await i(a);await Promise.all(r),e&&Si.postMessage({op:"connect",trackingId:e})}},{key:"disconnect",value:async function(t,e){var n=t.reduce((function(t,e){var n=o(e),r=di(n,2),i=r[0],a=r[1];return i&&a?(t[i]||(t[i]=[]),-1===t[i].indexOf(e)&&t[i].push(e),t):{}}),{}),r=[],i=function(t){var e=pi(t);e&&r.push(async function(){var r,i=mi(n[t]);try{for(i.s();!(r=i.n()).done;){var o=r.value;await e.unlink(o)}}catch(a){i.e(a)}finally{i.f()}}())};for(var a in n)i(a);await Promise.all(r),e&&Si.postMessage({op:"connect",trackingId:e})}},{key:"startPriceInterval",value:function(){this["_priceInterval"]||(this["_priceInterval"]=self.setInterval(this.emitPrices.bind(this),1e3))}},{key:"startAggrInterval",value:function(){this["_aggrInterval"]||(this["_aggrInterval"]=self.setInterval(this.emitPendingTrades.bind(this),50))}},{key:"startStatsInterval",value:function(){this["_statsInterval"]||(this["_statsInterval"]=self.setInterval(this.emitStats.bind(this),500))}},{key:"clearInterval",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){this["_"+t+"Interval"]&&(clearInterval(this["_"+t+"Interval"]),this["_"+t+"Interval"]=null)}))},{key:"fetchExchangeProducts",value:async function(t,e){var n=t.exchangeId,r=t.forceFetch;await pi(n).getProducts(r),Si.postMessage({op:"fetchExchangeProducts",trackingId:e})}},{key:"formatExchangeProducts",value:function(t,e){var n=t.exchangeId,r=t.response,i=pi(n).formatProducts(r);Si.postMessage({op:"formatExchangeProducts",data:i,trackingId:e})}},{key:"configureAggregator",value:function(t){var e=t.key,n=t.value;this.settings[e]!==n&&(this.settings[e]=n,"aggregationLength"===e&&this.bindTradesEvent())}},{key:"getHits",value:function(t,e){Si.postMessage({op:"getHits",trackingId:e,data:hi.reduce((function(t,e){return t+e.count}),0)})}}]),t}(),Pi=new xi;self.addEventListener("message",(function(t){var e=t.data;"function"===typeof Pi[e.op]&&Pi[e.op](e.data,e.trackingId)}));e["default"]=null},"717e":function(t,e,n){"use strict";var r=n("9e6e"),i=n("be7f"),o=n("7b27"),a=n("2ceb"),s=n("4dc6"),u=n("8936"),c=n("8013"),l=Object.prototype.toString;function f(t){if(!(this instanceof f))return new f(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);if(this.header=new c,r.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"===typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=r.inflateSetDictionary(this.strm,e.dictionary),n!==a.Z_OK)))throw new Error(s[n])}function h(t,e){var n=new f(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}function p(t,e){return e=e||{},e.raw=!0,h(t,e)}f.prototype.push=function(t,e){var n,s,u,c,f,h=this.strm,p=this.options.chunkSize,d=this.options.dictionary,y=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"===typeof t?h.input=o.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?h.input=new Uint8Array(t):h.input=t,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new i.Buf8(p),h.next_out=0,h.avail_out=p),n=r.inflate(h,a.Z_NO_FLUSH),n===a.Z_NEED_DICT&&d&&(n=r.inflateSetDictionary(this.strm,d)),n===a.Z_BUF_ERROR&&!0===y&&(n=a.Z_OK,y=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&n!==a.Z_STREAM_END&&(0!==h.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=o.utf8border(h.output,h.next_out),c=h.next_out-u,f=o.buf2string(h.output,u),h.next_out=c,h.avail_out=p-c,c&&i.arraySet(h.output,h.output,u,c,0),this.onData(f)):this.onData(i.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(y=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),h.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=f,e.inflate=h,e.inflateRaw=p,e.ungzip=h},"7b27":function(t,e,n){"use strict";var r=n("be7f"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(c){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(c){o=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function u(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",a=0;a<e;a++)n+=String.fromCharCode(t[a]);return n}a[254]=a[254]=1,e.string2buf=function(t){var e,n,i,o,a,s=t.length,u=0;for(o=0;o<s;o++)n=t.charCodeAt(o),55296===(64512&n)&&o+1<s&&(i=t.charCodeAt(o+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),u+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(u),a=0,o=0;a<u;o++)n=t.charCodeAt(o),55296===(64512&n)&&o+1<s&&(i=t.charCodeAt(o+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},e.buf2binstring=function(t){return u(t,t.length)},e.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},e.buf2string=function(t,e){var n,r,i,o,s=e||t.length,c=new Array(2*s);for(r=0,n=0;n<s;)if(i=t[n++],i<128)c[r++]=i;else if(o=a[i],o>4)c[r++]=65533,n+=o-1;else{i&=2===o?31:3===o?15:7;while(o>1&&n<s)i=i<<6|63&t[n++],o--;o>1?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return u(c,r)},e.utf8border=function(t,e){var n;e=e||t.length,e>t.length&&(e=t.length),n=e-1;while(n>=0&&128===(192&t[n]))n--;return n<0||0===n?e:n+a[t[n]]>e?n:e}},"7eb1":function(t,e,n){"use strict";var r=30,i=12;t.exports=function(t,e){var n,o,a,s,u,c,l,f,h,p,d,y,b,v,m,g,_,w,k,O,S,x,P,j,R;n=t.state,o=t.next_in,j=t.input,a=o+(t.avail_in-5),s=t.next_out,R=t.output,u=s-(e-t.avail_out),c=s+(t.avail_out-257),l=n.dmax,f=n.wsize,h=n.whave,p=n.wnext,d=n.window,y=n.hold,b=n.bits,v=n.lencode,m=n.distcode,g=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;t:do{b<15&&(y+=j[o++]<<b,b+=8,y+=j[o++]<<b,b+=8),w=v[y&g];e:for(;;){if(k=w>>>24,y>>>=k,b-=k,k=w>>>16&255,0===k)R[s++]=65535&w;else{if(!(16&k)){if(0===(64&k)){w=v[(65535&w)+(y&(1<<k)-1)];continue e}if(32&k){n.mode=i;break t}t.msg="invalid literal/length code",n.mode=r;break t}O=65535&w,k&=15,k&&(b<k&&(y+=j[o++]<<b,b+=8),O+=y&(1<<k)-1,y>>>=k,b-=k),b<15&&(y+=j[o++]<<b,b+=8,y+=j[o++]<<b,b+=8),w=m[y&_];n:for(;;){if(k=w>>>24,y>>>=k,b-=k,k=w>>>16&255,!(16&k)){if(0===(64&k)){w=m[(65535&w)+(y&(1<<k)-1)];continue n}t.msg="invalid distance code",n.mode=r;break t}if(S=65535&w,k&=15,b<k&&(y+=j[o++]<<b,b+=8,b<k&&(y+=j[o++]<<b,b+=8)),S+=y&(1<<k)-1,S>l){t.msg="invalid distance too far back",n.mode=r;break t}if(y>>>=k,b-=k,k=s-u,S>k){if(k=S-k,k>h&&n.sane){t.msg="invalid distance too far back",n.mode=r;break t}if(x=0,P=d,0===p){if(x+=f-k,k<O){O-=k;do{R[s++]=d[x++]}while(--k);x=s-S,P=R}}else if(p<k){if(x+=f+p-k,k-=p,k<O){O-=k;do{R[s++]=d[x++]}while(--k);if(x=0,p<O){k=p,O-=k;do{R[s++]=d[x++]}while(--k);x=s-S,P=R}}}else if(x+=p-k,k<O){O-=k;do{R[s++]=d[x++]}while(--k);x=s-S,P=R}while(O>2)R[s++]=P[x++],R[s++]=P[x++],R[s++]=P[x++],O-=3;O&&(R[s++]=P[x++],O>1&&(R[s++]=P[x++]))}else{x=s-S;do{R[s++]=R[x++],R[s++]=R[x++],R[s++]=R[x++],O-=3}while(O>2);O&&(R[s++]=R[x++],O>1&&(R[s++]=R[x++]))}break}}break}}while(o<a&&s<c);O=b>>3,o-=O,b-=O<<3,y&=(1<<b)-1,t.next_in=o,t.next_out=s,t.avail_in=o<a?a-o+5:5-(o-a),t.avail_out=s<c?c-s+257:257-(s-c),n.hold=y,n.bits=b}},8013:function(t,e,n){"use strict";function r(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=r},8936:function(t,e,n){"use strict";function r(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=r},"9e6e":function(t,e,n){"use strict";var r=n("be7f"),i=n("c834"),o=n("eeda"),a=n("7eb1"),s=n("6853"),u=0,c=1,l=2,f=4,h=5,p=6,d=0,y=1,b=2,v=-2,m=-3,g=-4,_=-5,w=8,k=1,O=2,S=3,x=4,P=5,j=6,R=7,A=8,T=9,E=10,z=11,C=12,I=13,B=14,N=15,D=16,U=17,M=18,L=19,q=20,J=21,Z=22,F=23,K=24,H=25,G=26,$=27,W=28,Q=29,X=30,Y=31,V=32,tt=852,et=592,nt=15,rt=nt;function it(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function ot(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function at(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=k,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(tt),e.distcode=e.distdyn=new r.Buf32(et),e.sane=1,e.back=-1,d):v}function st(t){var e;return t&&t.state?(e=t.state,e.wsize=0,e.whave=0,e.wnext=0,at(t)):v}function ut(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?v:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,st(t))):v}function ct(t,e){var n,r;return t?(r=new ot,t.state=r,r.window=null,n=ut(t,e),n!==d&&(t.state=null),n):v}function lt(t){return ct(t,rt)}var ft,ht,pt=!0;function dt(t){if(pt){var e;ft=new r.Buf32(512),ht=new r.Buf32(32),e=0;while(e<144)t.lens[e++]=8;while(e<256)t.lens[e++]=9;while(e<280)t.lens[e++]=7;while(e<288)t.lens[e++]=8;s(c,t.lens,0,288,ft,0,t.work,{bits:9}),e=0;while(e<32)t.lens[e++]=5;s(l,t.lens,0,32,ht,0,t.work,{bits:5}),pt=!1}t.lencode=ft,t.lenbits=9,t.distcode=ht,t.distbits=5}function yt(t,e,n,i){var o,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,e,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(o=a.wsize-a.wnext,o>i&&(o=i),r.arraySet(a.window,e,n-i,o,a.wnext),i-=o,i?(r.arraySet(a.window,e,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}function bt(t,e){var n,tt,et,nt,rt,ot,at,st,ut,ct,lt,ft,ht,pt,bt,vt,mt,gt,_t,wt,kt,Ot,St,xt,Pt=0,jt=new r.Buf8(4),Rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return v;n=t.state,n.mode===C&&(n.mode=I),rt=t.next_out,et=t.output,at=t.avail_out,nt=t.next_in,tt=t.input,ot=t.avail_in,st=n.hold,ut=n.bits,ct=ot,lt=at,Ot=d;t:for(;;)switch(n.mode){case k:if(0===n.wrap){n.mode=I;break}while(ut<16){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}if(2&n.wrap&&35615===st){n.check=0,jt[0]=255&st,jt[1]=st>>>8&255,n.check=o(n.check,jt,2,0),st=0,ut=0,n.mode=O;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&st)<<8)+(st>>8))%31){t.msg="incorrect header check",n.mode=X;break}if((15&st)!==w){t.msg="unknown compression method",n.mode=X;break}if(st>>>=4,ut-=4,kt=8+(15&st),0===n.wbits)n.wbits=kt;else if(kt>n.wbits){t.msg="invalid window size",n.mode=X;break}n.dmax=1<<kt,t.adler=n.check=1,n.mode=512&st?E:C,st=0,ut=0;break;case O:while(ut<16){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}if(n.flags=st,(255&n.flags)!==w){t.msg="unknown compression method",n.mode=X;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=X;break}n.head&&(n.head.text=st>>8&1),512&n.flags&&(jt[0]=255&st,jt[1]=st>>>8&255,n.check=o(n.check,jt,2,0)),st=0,ut=0,n.mode=S;case S:while(ut<32){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}n.head&&(n.head.time=st),512&n.flags&&(jt[0]=255&st,jt[1]=st>>>8&255,jt[2]=st>>>16&255,jt[3]=st>>>24&255,n.check=o(n.check,jt,4,0)),st=0,ut=0,n.mode=x;case x:while(ut<16){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}n.head&&(n.head.xflags=255&st,n.head.os=st>>8),512&n.flags&&(jt[0]=255&st,jt[1]=st>>>8&255,n.check=o(n.check,jt,2,0)),st=0,ut=0,n.mode=P;case P:if(1024&n.flags){while(ut<16){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}n.length=st,n.head&&(n.head.extra_len=st),512&n.flags&&(jt[0]=255&st,jt[1]=st>>>8&255,n.check=o(n.check,jt,2,0)),st=0,ut=0}else n.head&&(n.head.extra=null);n.mode=j;case j:if(1024&n.flags&&(ft=n.length,ft>ot&&(ft=ot),ft&&(n.head&&(kt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,tt,nt,ft,kt)),512&n.flags&&(n.check=o(n.check,tt,ft,nt)),ot-=ft,nt+=ft,n.length-=ft),n.length))break t;n.length=0,n.mode=R;case R:if(2048&n.flags){if(0===ot)break t;ft=0;do{kt=tt[nt+ft++],n.head&&kt&&n.length<65536&&(n.head.name+=String.fromCharCode(kt))}while(kt&&ft<ot);if(512&n.flags&&(n.check=o(n.check,tt,ft,nt)),ot-=ft,nt+=ft,kt)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=A;case A:if(4096&n.flags){if(0===ot)break t;ft=0;do{kt=tt[nt+ft++],n.head&&kt&&n.length<65536&&(n.head.comment+=String.fromCharCode(kt))}while(kt&&ft<ot);if(512&n.flags&&(n.check=o(n.check,tt,ft,nt)),ot-=ft,nt+=ft,kt)break t}else n.head&&(n.head.comment=null);n.mode=T;case T:if(512&n.flags){while(ut<16){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}if(st!==(65535&n.check)){t.msg="header crc mismatch",n.mode=X;break}st=0,ut=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=C;break;case E:while(ut<32){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}t.adler=n.check=it(st),st=0,ut=0,n.mode=z;case z:if(0===n.havedict)return t.next_out=rt,t.avail_out=at,t.next_in=nt,t.avail_in=ot,n.hold=st,n.bits=ut,b;t.adler=n.check=1,n.mode=C;case C:if(e===h||e===p)break t;case I:if(n.last){st>>>=7&ut,ut-=7&ut,n.mode=$;break}while(ut<3){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}switch(n.last=1&st,st>>>=1,ut-=1,3&st){case 0:n.mode=B;break;case 1:if(dt(n),n.mode=q,e===p){st>>>=2,ut-=2;break t}break;case 2:n.mode=U;break;case 3:t.msg="invalid block type",n.mode=X}st>>>=2,ut-=2;break;case B:st>>>=7&ut,ut-=7&ut;while(ut<32){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}if((65535&st)!==(st>>>16^65535)){t.msg="invalid stored block lengths",n.mode=X;break}if(n.length=65535&st,st=0,ut=0,n.mode=N,e===p)break t;case N:n.mode=D;case D:if(ft=n.length,ft){if(ft>ot&&(ft=ot),ft>at&&(ft=at),0===ft)break t;r.arraySet(et,tt,nt,ft,rt),ot-=ft,nt+=ft,at-=ft,rt+=ft,n.length-=ft;break}n.mode=C;break;case U:while(ut<14){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}if(n.nlen=257+(31&st),st>>>=5,ut-=5,n.ndist=1+(31&st),st>>>=5,ut-=5,n.ncode=4+(15&st),st>>>=4,ut-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=X;break}n.have=0,n.mode=M;case M:while(n.have<n.ncode){while(ut<3){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}n.lens[Rt[n.have++]]=7&st,st>>>=3,ut-=3}while(n.have<19)n.lens[Rt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,St={bits:n.lenbits},Ot=s(u,n.lens,0,19,n.lencode,0,n.work,St),n.lenbits=St.bits,Ot){t.msg="invalid code lengths set",n.mode=X;break}n.have=0,n.mode=L;case L:while(n.have<n.nlen+n.ndist){for(;;){if(Pt=n.lencode[st&(1<<n.lenbits)-1],bt=Pt>>>24,vt=Pt>>>16&255,mt=65535&Pt,bt<=ut)break;if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}if(mt<16)st>>>=bt,ut-=bt,n.lens[n.have++]=mt;else{if(16===mt){xt=bt+2;while(ut<xt){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}if(st>>>=bt,ut-=bt,0===n.have){t.msg="invalid bit length repeat",n.mode=X;break}kt=n.lens[n.have-1],ft=3+(3&st),st>>>=2,ut-=2}else if(17===mt){xt=bt+3;while(ut<xt){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}st>>>=bt,ut-=bt,kt=0,ft=3+(7&st),st>>>=3,ut-=3}else{xt=bt+7;while(ut<xt){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}st>>>=bt,ut-=bt,kt=0,ft=11+(127&st),st>>>=7,ut-=7}if(n.have+ft>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=X;break}while(ft--)n.lens[n.have++]=kt}}if(n.mode===X)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=X;break}if(n.lenbits=9,St={bits:n.lenbits},Ot=s(c,n.lens,0,n.nlen,n.lencode,0,n.work,St),n.lenbits=St.bits,Ot){t.msg="invalid literal/lengths set",n.mode=X;break}if(n.distbits=6,n.distcode=n.distdyn,St={bits:n.distbits},Ot=s(l,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,St),n.distbits=St.bits,Ot){t.msg="invalid distances set",n.mode=X;break}if(n.mode=q,e===p)break t;case q:n.mode=J;case J:if(ot>=6&&at>=258){t.next_out=rt,t.avail_out=at,t.next_in=nt,t.avail_in=ot,n.hold=st,n.bits=ut,a(t,lt),rt=t.next_out,et=t.output,at=t.avail_out,nt=t.next_in,tt=t.input,ot=t.avail_in,st=n.hold,ut=n.bits,n.mode===C&&(n.back=-1);break}for(n.back=0;;){if(Pt=n.lencode[st&(1<<n.lenbits)-1],bt=Pt>>>24,vt=Pt>>>16&255,mt=65535&Pt,bt<=ut)break;if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}if(vt&&0===(240&vt)){for(gt=bt,_t=vt,wt=mt;;){if(Pt=n.lencode[wt+((st&(1<<gt+_t)-1)>>gt)],bt=Pt>>>24,vt=Pt>>>16&255,mt=65535&Pt,gt+bt<=ut)break;if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}st>>>=gt,ut-=gt,n.back+=gt}if(st>>>=bt,ut-=bt,n.back+=bt,n.length=mt,0===vt){n.mode=G;break}if(32&vt){n.back=-1,n.mode=C;break}if(64&vt){t.msg="invalid literal/length code",n.mode=X;break}n.extra=15&vt,n.mode=Z;case Z:if(n.extra){xt=n.extra;while(ut<xt){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}n.length+=st&(1<<n.extra)-1,st>>>=n.extra,ut-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=F;case F:for(;;){if(Pt=n.distcode[st&(1<<n.distbits)-1],bt=Pt>>>24,vt=Pt>>>16&255,mt=65535&Pt,bt<=ut)break;if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}if(0===(240&vt)){for(gt=bt,_t=vt,wt=mt;;){if(Pt=n.distcode[wt+((st&(1<<gt+_t)-1)>>gt)],bt=Pt>>>24,vt=Pt>>>16&255,mt=65535&Pt,gt+bt<=ut)break;if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}st>>>=gt,ut-=gt,n.back+=gt}if(st>>>=bt,ut-=bt,n.back+=bt,64&vt){t.msg="invalid distance code",n.mode=X;break}n.offset=mt,n.extra=15&vt,n.mode=K;case K:if(n.extra){xt=n.extra;while(ut<xt){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}n.offset+=st&(1<<n.extra)-1,st>>>=n.extra,ut-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=X;break}n.mode=H;case H:if(0===at)break t;if(ft=lt-at,n.offset>ft){if(ft=n.offset-ft,ft>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=X;break}ft>n.wnext?(ft-=n.wnext,ht=n.wsize-ft):ht=n.wnext-ft,ft>n.length&&(ft=n.length),pt=n.window}else pt=et,ht=rt-n.offset,ft=n.length;ft>at&&(ft=at),at-=ft,n.length-=ft;do{et[rt++]=pt[ht++]}while(--ft);0===n.length&&(n.mode=J);break;case G:if(0===at)break t;et[rt++]=n.length,at--,n.mode=J;break;case $:if(n.wrap){while(ut<32){if(0===ot)break t;ot--,st|=tt[nt++]<<ut,ut+=8}if(lt-=at,t.total_out+=lt,n.total+=lt,lt&&(t.adler=n.check=n.flags?o(n.check,et,lt,rt-lt):i(n.check,et,lt,rt-lt)),lt=at,(n.flags?st:it(st))!==n.check){t.msg="incorrect data check",n.mode=X;break}st=0,ut=0}n.mode=W;case W:if(n.wrap&&n.flags){while(ut<32){if(0===ot)break t;ot--,st+=tt[nt++]<<ut,ut+=8}if(st!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=X;break}st=0,ut=0}n.mode=Q;case Q:Ot=y;break t;case X:Ot=m;break t;case Y:return g;case V:default:return v}return t.next_out=rt,t.avail_out=at,t.next_in=nt,t.avail_in=ot,n.hold=st,n.bits=ut,(n.wsize||lt!==t.avail_out&&n.mode<X&&(n.mode<$||e!==f))&&yt(t,t.output,t.next_out,lt-t.avail_out)?(n.mode=Y,g):(ct-=t.avail_in,lt-=t.avail_out,t.total_in+=ct,t.total_out+=lt,n.total+=lt,n.wrap&&lt&&(t.adler=n.check=n.flags?o(n.check,et,lt,t.next_out-lt):i(n.check,et,lt,t.next_out-lt)),t.data_type=n.bits+(n.last?64:0)+(n.mode===C?128:0)+(n.mode===q||n.mode===N?256:0),(0===ct&&0===lt||e===f)&&Ot===d&&(Ot=_),Ot)}function vt(t){if(!t||!t.state)return v;var e=t.state;return e.window&&(e.window=null),t.state=null,d}function mt(t,e){var n;return t&&t.state?(n=t.state,0===(2&n.wrap)?v:(n.head=e,e.done=!1,d)):v}function gt(t,e){var n,r,o,a=e.length;return t&&t.state?(n=t.state,0!==n.wrap&&n.mode!==z?v:n.mode===z&&(r=1,r=i(r,e,a,0),r!==n.check)?m:(o=yt(t,e,a,a),o?(n.mode=Y,g):(n.havedict=1,d))):v}e.inflateReset=st,e.inflateReset2=ut,e.inflateResetKeep=at,e.inflateInit=lt,e.inflateInit2=ct,e.inflate=bt,e.inflateEnd=vt,e.inflateGetHeader=mt,e.inflateSetDictionary=gt,e.inflateInfo="pako inflate (from Nodeca project)"},a177:function(t,e,n){"use strict";var r,i=n("be7f"),o=n("07f4"),a=n("c834"),s=n("eeda"),u=n("4dc6"),c=0,l=1,f=3,h=4,p=5,d=0,y=1,b=-2,v=-3,m=-5,g=-1,_=1,w=2,k=3,O=4,S=0,x=2,P=8,j=9,R=15,A=8,T=29,E=256,z=E+1+T,C=30,I=19,B=2*z+1,N=15,D=3,U=258,M=U+D+1,L=32,q=42,J=69,Z=73,F=91,K=103,H=113,G=666,$=1,W=2,Q=3,X=4,Y=3;function V(t,e){return t.msg=u[e],e}function tt(t){return(t<<1)-(t>4?9:0)}function et(t){var e=t.length;while(--e>=0)t[e]=0}function nt(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(i.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function rt(t,e){o._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,nt(t.strm)}function it(t,e){t.pending_buf[t.pending++]=e}function ot(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function at(t,e,n,r){var o=t.avail_in;return o>r&&(o=r),0===o?0:(t.avail_in-=o,i.arraySet(e,t.input,t.next_in,o,n),1===t.state.wrap?t.adler=a(t.adler,e,o,n):2===t.state.wrap&&(t.adler=s(t.adler,e,o,n)),t.next_in+=o,t.total_in+=o,o)}function st(t,e){var n,r,i=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,u=t.strstart>t.w_size-M?t.strstart-(t.w_size-M):0,c=t.window,l=t.w_mask,f=t.prev,h=t.strstart+U,p=c[o+a-1],d=c[o+a];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(n=e,c[n+a]===d&&c[n+a-1]===p&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<h);if(r=U-(h-o),o=h-U,r>a){if(t.match_start=e,a=r,r>=s)break;p=c[o+a-1],d=c[o+a]}}}while((e=f[e&l])>u&&0!==--i);return a<=t.lookahead?a:t.lookahead}function ut(t){var e,n,r,o,a,s=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=s+(s-M)){i.arraySet(t.window,t.window,s,s,0),t.match_start-=s,t.strstart-=s,t.block_start-=s,n=t.hash_size,e=n;do{r=t.head[--e],t.head[e]=r>=s?r-s:0}while(--n);n=s,e=n;do{r=t.prev[--e],t.prev[e]=r>=s?r-s:0}while(--n);o+=s}if(0===t.strm.avail_in)break;if(n=at(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=n,t.lookahead+t.insert>=D){a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;while(t.insert)if(t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+D-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,t.lookahead+t.insert<D)break}}while(t.lookahead<M&&0!==t.strm.avail_in)}function ct(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ut(t),0===t.lookahead&&e===c)return $;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,rt(t,!1),0===t.strm.avail_out))return $;if(t.strstart-t.block_start>=t.w_size-M&&(rt(t,!1),0===t.strm.avail_out))return $}return t.insert=0,e===h?(rt(t,!0),0===t.strm.avail_out?Q:X):(t.strstart>t.block_start&&(rt(t,!1),t.strm.avail_out),$)}function lt(t,e){for(var n,r;;){if(t.lookahead<M){if(ut(t),t.lookahead<M&&e===c)return $;if(0===t.lookahead)break}if(n=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-M&&(t.match_length=st(t,n)),t.match_length>=D)if(r=o._tr_tally(t,t.strstart-t.match_start,t.match_length-D),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=D){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(rt(t,!1),0===t.strm.avail_out))return $}return t.insert=t.strstart<D-1?t.strstart:D-1,e===h?(rt(t,!0),0===t.strm.avail_out?Q:X):t.last_lit&&(rt(t,!1),0===t.strm.avail_out)?$:W}function ft(t,e){for(var n,r,i;;){if(t.lookahead<M){if(ut(t),t.lookahead<M&&e===c)return $;if(0===t.lookahead)break}if(n=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=D-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-M&&(t.match_length=st(t,n),t.match_length<=5&&(t.strategy===_||t.match_length===D&&t.strstart-t.match_start>4096)&&(t.match_length=D-1)),t.prev_length>=D&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-D,r=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-D),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=D-1,t.strstart++,r&&(rt(t,!1),0===t.strm.avail_out))return $}else if(t.match_available){if(r=o._tr_tally(t,0,t.window[t.strstart-1]),r&&rt(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return $}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<D-1?t.strstart:D-1,e===h?(rt(t,!0),0===t.strm.avail_out?Q:X):t.last_lit&&(rt(t,!1),0===t.strm.avail_out)?$:W}function ht(t,e){for(var n,r,i,a,s=t.window;;){if(t.lookahead<=U){if(ut(t),t.lookahead<=U&&e===c)return $;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=D&&t.strstart>0&&(i=t.strstart-1,r=s[i],r===s[++i]&&r===s[++i]&&r===s[++i])){a=t.strstart+U;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);t.match_length=U-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=D?(n=o._tr_tally(t,1,t.match_length-D),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(rt(t,!1),0===t.strm.avail_out))return $}return t.insert=0,e===h?(rt(t,!0),0===t.strm.avail_out?Q:X):t.last_lit&&(rt(t,!1),0===t.strm.avail_out)?$:W}function pt(t,e){for(var n;;){if(0===t.lookahead&&(ut(t),0===t.lookahead)){if(e===c)return $;break}if(t.match_length=0,n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(rt(t,!1),0===t.strm.avail_out))return $}return t.insert=0,e===h?(rt(t,!0),0===t.strm.avail_out?Q:X):t.last_lit&&(rt(t,!1),0===t.strm.avail_out)?$:W}function dt(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function yt(t){t.window_size=2*t.w_size,et(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=D-1,t.match_available=0,t.ins_h=0}function bt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=P,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*B),this.dyn_dtree=new i.Buf16(2*(2*C+1)),this.bl_tree=new i.Buf16(2*(2*I+1)),et(this.dyn_ltree),et(this.dyn_dtree),et(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(N+1),this.heap=new i.Buf16(2*z+1),et(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*z+1),et(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function vt(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=x,e=t.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?q:H,t.adler=2===e.wrap?0:1,e.last_flush=c,o._tr_init(e),d):V(t,b)}function mt(t){var e=vt(t);return e===d&&yt(t.state),e}function gt(t,e){return t&&t.state?2!==t.state.wrap?b:(t.state.gzhead=e,d):b}function _t(t,e,n,r,o,a){if(!t)return b;var s=1;if(e===g&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>j||n!==P||r<8||r>15||e<0||e>9||a<0||a>O)return V(t,b);8===r&&(r=9);var u=new bt;return t.state=u,u.strm=t,u.wrap=s,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+D-1)/D),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=e,u.strategy=a,u.method=n,mt(t)}function wt(t,e){return _t(t,e,P,R,A,S)}function kt(t,e){var n,i,a,u;if(!t||!t.state||e>p||e<0)return t?V(t,b):b;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===G&&e!==h)return V(t,0===t.avail_out?m:b);if(i.strm=t,n=i.last_flush,i.last_flush=e,i.status===q)if(2===i.wrap)t.adler=0,it(i,31),it(i,139),it(i,8),i.gzhead?(it(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),it(i,255&i.gzhead.time),it(i,i.gzhead.time>>8&255),it(i,i.gzhead.time>>16&255),it(i,i.gzhead.time>>24&255),it(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),it(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(it(i,255&i.gzhead.extra.length),it(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=s(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=J):(it(i,0),it(i,0),it(i,0),it(i,0),it(i,0),it(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),it(i,Y),i.status=H);else{var v=P+(i.w_bits-8<<4)<<8,g=-1;g=i.strategy>=w||i.level<2?0:i.level<6?1:6===i.level?2:3,v|=g<<6,0!==i.strstart&&(v|=L),v+=31-v%31,i.status=H,ot(i,v),0!==i.strstart&&(ot(i,t.adler>>>16),ot(i,65535&t.adler)),t.adler=1}if(i.status===J)if(i.gzhead.extra){a=i.pending;while(i.gzindex<(65535&i.gzhead.extra.length)){if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),nt(t),a=i.pending,i.pending===i.pending_buf_size))break;it(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++}i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=Z)}else i.status=Z;if(i.status===Z)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),nt(t),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,it(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.gzindex=0,i.status=F)}else i.status=F;if(i.status===F)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),nt(t),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,it(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.status=K)}else i.status=K;if(i.status===K&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&nt(t),i.pending+2<=i.pending_buf_size&&(it(i,255&t.adler),it(i,t.adler>>8&255),t.adler=0,i.status=H)):i.status=H),0!==i.pending){if(nt(t),0===t.avail_out)return i.last_flush=-1,d}else if(0===t.avail_in&&tt(e)<=tt(n)&&e!==h)return V(t,m);if(i.status===G&&0!==t.avail_in)return V(t,m);if(0!==t.avail_in||0!==i.lookahead||e!==c&&i.status!==G){var _=i.strategy===w?pt(i,e):i.strategy===k?ht(i,e):r[i.level].func(i,e);if(_!==Q&&_!==X||(i.status=G),_===$||_===Q)return 0===t.avail_out&&(i.last_flush=-1),d;if(_===W&&(e===l?o._tr_align(i):e!==p&&(o._tr_stored_block(i,0,0,!1),e===f&&(et(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),nt(t),0===t.avail_out))return i.last_flush=-1,d}return e!==h?d:i.wrap<=0?y:(2===i.wrap?(it(i,255&t.adler),it(i,t.adler>>8&255),it(i,t.adler>>16&255),it(i,t.adler>>24&255),it(i,255&t.total_in),it(i,t.total_in>>8&255),it(i,t.total_in>>16&255),it(i,t.total_in>>24&255)):(ot(i,t.adler>>>16),ot(i,65535&t.adler)),nt(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?d:y)}function Ot(t){var e;return t&&t.state?(e=t.state.status,e!==q&&e!==J&&e!==Z&&e!==F&&e!==K&&e!==H&&e!==G?V(t,b):(t.state=null,e===H?V(t,v):d)):b}function St(t,e){var n,r,o,s,u,c,l,f,h=e.length;if(!t||!t.state)return b;if(n=t.state,s=n.wrap,2===s||1===s&&n.status!==q||n.lookahead)return b;1===s&&(t.adler=a(t.adler,e,h,0)),n.wrap=0,h>=n.w_size&&(0===s&&(et(n.head),n.strstart=0,n.block_start=0,n.insert=0),f=new i.Buf8(n.w_size),i.arraySet(f,e,h-n.w_size,n.w_size,0),e=f,h=n.w_size),u=t.avail_in,c=t.next_in,l=t.input,t.avail_in=h,t.next_in=0,t.input=e,ut(n);while(n.lookahead>=D){r=n.strstart,o=n.lookahead-(D-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+D-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=D-1,ut(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=D-1,n.match_available=0,t.next_in=c,t.input=l,t.avail_in=u,n.wrap=s,d}r=[new dt(0,0,0,0,ct),new dt(4,4,8,4,lt),new dt(4,5,16,8,lt),new dt(4,6,32,32,lt),new dt(4,4,16,16,ft),new dt(8,16,32,32,ft),new dt(8,16,128,128,ft),new dt(8,32,128,256,ft),new dt(32,128,258,1024,ft),new dt(32,258,258,4096,ft)],e.deflateInit=wt,e.deflateInit2=_t,e.deflateReset=mt,e.deflateResetKeep=vt,e.deflateSetHeader=gt,e.deflate=kt,e.deflateEnd=Ot,e.deflateSetDictionary=St,e.deflateInfo="pako deflate (from Nodeca project)"},ba10:function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,n,r,o){if("function"!==typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||t,o),u=i?i+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function u(t,e){0===--t._eventsCount?t._events=new o:delete t._events[e]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),c.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},c.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},c.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},c.prototype.emit=function(t,e,n,r,o,a){var s=i?i+t:t;if(!this._events[s])return!1;var u,c,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,r),!0;case 5:return l.fn.call(l.context,e,n,r,o),!0;case 6:return l.fn.call(l.context,e,n,r,o,a),!0}for(c=1,u=new Array(f-1);c<f;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,n);break;case 4:l[c].fn.call(l[c].context,e,n,r);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},c.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,n,r){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return u(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||r&&!a.once||n&&a.context!==n||u(this,o);else{for(var s=0,c=[],l=a.length;s<l;s++)(a[s].fn!==e||r&&!a[s].once||n&&a[s].context!==n)&&c.push(a[s]);c.length?this._events[o]=1===c.length?c[0]:c:u(this,o)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&u(this,e)):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,t.exports=c},be7f:function(t,e,n){"use strict";var r="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){var e=Array.prototype.slice.call(arguments,1);while(e.length){var n=e.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(t[r]=n[r])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,n,r,i){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),i);else for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){var e,n,r,i,o,a;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(a=new Uint8Array(r),i=0,e=0,n=t.length;e<n;e++)o=t[e],a.set(o,i),i+=o.length;return a}},a={arraySet:function(t,e,n,r,i){for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,o)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(r)},c834:function(t,e,n){"use strict";function r(t,e,n,r){var i=65535&t|0,o=t>>>16&65535|0,a=0;while(0!==n){a=n>2e3?2e3:n,n-=a;do{i=i+e[r++]|0,o=o+i|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}t.exports=r},d7ac:function(t,e,n){"use strict";var r=n("be7f").assign,i=n("4126"),o=n("717e"),a=n("2ceb"),s={};r(s,i,o,a),t.exports=s},eeda:function(t,e,n){"use strict";function r(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}var i=r();function o(t,e,n,r){var o=i,a=r+n;t^=-1;for(var s=r;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}t.exports=o}});